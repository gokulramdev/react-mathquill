/**
 * MathQuill v0.10.1, by Han, Jeanine, and Mary
 * http://mathquill.com | maintainers@mathquill.com
 *
 * This Source Code Form is subject to the terms of the
 * Mozilla Public License, v. 2.0. If a copy of the MPL
 * was not distributed with this file, You can obtain
 * one at http://mozilla.org/MPL/2.0/.
 */
!function(){function t(){}function e(t){var e=t.length-1;return function(){var n=v.call(arguments,0,e),i=v.call(arguments,e);return t.apply(this,n.concat([i]))}}function n(t){return e(function(e,n){"function"!=typeof e&&(e=w(e));var i=function(t){return e.apply(t,[t].concat(n))};return t.call(this,i)})}function i(t){var e=v.call(arguments,1);return function(){return t.apply(this,e)}}function s(t,e){if(!e)throw new Error("prayer failed: "+t)}function r(t){s("a direction was passed",t===x||t===k)}function a(){Q||(Q=!0,setTimeout(o))}function o(){Q=!1,j={}}function l(t,e,n){s("a parent is always present",t),s("leftward is properly set up",function(){return e?e[k]===n&&e.parent===t:t.ends[x]===n}()),s("rightward is properly set up",function(){return n?n[x]===e&&n.parent===t:t.ends[k]===e}())}function c(){window.console&&console.warn('You are using the MathQuill API without specifying an interface version, which will fail in v1.0.0. Easiest fix is to do the following before doing anything else:\n\n    MathQuill = MathQuill.getInterface(1);\n    // now MathQuill.MathField() works like it used to\n\nSee also the "`dev` branch (2014–2015) → v0.10.0 Migration Guide" at\n  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide')}function u(t){return c(),Vt(t)}function h(e){function n(t){var e,n;return t&&t.nodeType?(e=T.getNodeOfElement(y(t).children(".mq-root-block")[0]),n=e&&e.controller,n?s[n.KIND_OF_MQ](n):null):null}function i(t,e){var n,i,r;e&&e.handlers&&(e.handlers={fns:e.handlers,APIClasses:s});for(n in e)e.hasOwnProperty(n)&&(i=e[n],r=R[n],t[n]=r?r(i):i)}var s,r,a;if(!(M<=e&&e<=N))throw"Only interface versions between "+M+" and "+N+" supported. You specified: "+e;s={},n.L=x,n.R=k,n.saneKeyboardEvents=$,n.config=function(t){return i(B.p,t),this},n.registerEmbed=function(t,e){if(!/^[a-z][a-z0-9]*$/i.test(t))throw"Embed name must start with letter and be only letters and digits";z[t]=e},r=s.AbstractMathQuill=q(I,function(t){t.init=function(t){this.__controller=t,this.__options=t.options,this.id=t.id,this.data=t.data},t.__mathquillify=function(t){var e,n=this.__controller,i=n.root,s=n.container;n.createTextarea(),e=s.addClass(t).contents().detach(),i.jQ=y('<span class="mq-root-block"/>').appendTo(s),T.linkElementByBlockId(i.jQ[0],i.id),this.latex(e.text()),this.revert=function(){return s.empty().unbind(".mathquill").removeClass("mq-editable-field mq-math-mode mq-text-mode").append(e)}},t.config=function(t){return i(this.__options,t),this},t.el=function(){return this.__controller.container[0]},t.text=function(){return this.__controller.exportText()},t.mathspeak=function(){return this.__controller.exportMathSpeak()},t.latex=function(t){return arguments.length>0?(this.__controller.renderLatexMath(t),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()},t.html=function(){return this.__controller.root.jQ.html().replace(/ mathquill-(?:command|block)-id="?\d+"?/g,"").replace(/<span class="?mq-cursor( mq-blink)?"?>.?<\/span>/i,"").replace(/ mq-hasCursor|mq-hasCursor ?/,"").replace(/ class=(""|(?= |>))/g,"")},t.reflow=function(){return this.__controller.root.postOrder("reflow"),this}}),n.prototype=r.prototype,s.EditableField=q(r,function(e,n){e.__mathquillify=function(){return n.__mathquillify.apply(this,arguments),this.__controller.editable=!0,this.__controller.delegateMouseEvents(),this.__controller.editablesTextareaEvents(),this},e.focus=function(){return this.__controller.textarea.focus(),this},e.blur=function(){return this.__controller.textarea.blur(),this},e.write=function(t){return this.__controller.writeLatex(t),this.__controller.scrollHoriz(),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this},e.cmd=function(t){var e,n=this.__controller.notify(),i=n.cursor;return/^\\[a-z]+$/i.test(t)?(t=t.slice(1),(e=L[t]||Nt[t])&&(t=e(t),i.selection&&t.replaces(i.replaceSelection()),t.createLeftOf(i.show()),this.__controller.scrollHoriz())):i.parent.write(i,t),n.blurred&&i.hide().parent.blur(),this},e.select=function(){var t=this.__controller;for(t.notify("move").cursor.insAtRightEnd(t.root);t.cursor[x];)t.selectLeft();return this},e.clearSelection=function(){return this.__controller.cursor.clearSelection(),this},e.moveToDirEnd=function(t){return this.__controller.notify("move").cursor.insAtDirEnd(t,this.__controller.root),this},e.moveToLeftEnd=function(){return this.moveToDirEnd(x)},e.moveToRightEnd=function(){return this.moveToDirEnd(k)},e.keystroke=function(e){var n;for(e=e.replace(/^\s+|\s+$/g,"").split(/\s+/),n=0;n<e.length;n+=1)this.__controller.keystroke(e[n],{preventDefault:t});return this},e.typedText=function(t){for(var e=0;e<t.length;e+=1)this.__controller.typedText(t.charAt(e));return this},e.dropEmbedded=function(t,e,n){var i,s=t-y(window).scrollLeft(),r=e-y(window).scrollTop(),a=document.elementFromPoint(s,r);this.__controller.seek(y(a),t,e),i=Mt().setOptions(n),i.createLeftOf(this.__controller.cursor)},e.setAriaLabel=function(t){return this.__controller.ariaLabel=t&&"string"==typeof t&&""!=t?t:"MathQuill Input",this},e.getAriaLabel=function(){return this.__controller.ariaLabel||"MathQuill Input"},e.setAriaPostLabel=function(t){return this.__controller.ariaPostLabel=t&&"string"==typeof t&&""!=t?t:"",this},e.getAriaPostLabel=function(){return this.__controller.ariaPostLabel||""},e.clickAt=function(t,e,n){n=n||document.elementFromPoint(t,e);var i=this.__controller,s=i.root;return Wt.contains(s.jQ[0],n)||(n=s.jQ[0]),i.seek(y(n),t+pageXOffset,e+pageYOffset),i.blurred&&this.focus(),this},e.ignoreNextMousedown=function(t){return this.__controller.cursor.options.ignoreNextMousedown=t,this}}),n.EditableField=function(){throw"wtf don't call me, I'm 'abstract'"},n.EditableField.prototype=s.EditableField.prototype;for(a in A)!function(t,i){var r=s[t]=i(s);n[t]=function(i,s){var a,o=n(i);return o instanceof r||!i||!i.nodeType?o:(a=E(r.RootBlock(),y(i),B()),a.KIND_OF_MQ=t,r(a).__mathquillify(s,e))},n[t].prototype=r.prototype}(a,A[a]);return n}function f(t){var e,n="moveOutOf deleteOutOf selectOutOf upOutOf downOutOf".split(" ");for(e=0;e<n.length;e+=1)!function(e){t[e]=function(t){this.controller.handle(e,t)}}(n[e]);t.reflow=function(){this.controller.handle("reflow"),this.controller.handle("edited"),this.controller.handle("edit")}}function p(t,e,n){return q(tt,{ctrlSeq:t,htmlTemplate:"<"+e+" "+n+">&0</"+e+">"})}function d(t){var e=this.parent,n=t;do{if(n[k])return t.insLeftOf(e);n=n.parent.parent}while(n!==e);t.insRightOf(e)}function m(t,e){t.jQadd=function(){e.jQadd.apply(this,arguments),this.delimjQs=this.jQ.children(":first").add(this.jQ.children(":last")),this.contentjQ=this.jQ.children(":eq(1)")},t.reflow=function(){var t=this.contentjQ.outerHeight()/parseFloat(this.contentjQ.css("fontSize"));qt(this.delimjQs,Ht(1+.2*(t-1),1.2),1.2*t)}}function g(t,e,n){var e=e||t,s=Rt[t],r=Rt[e];S[t]=i(Bt,x,t,s,e,r),S[s]=i(Bt,k,t,s,e,r),It[t]=It[s]=n}var b,v,w,q,x,k,y,O,j,Q,T,C,L,S,_,D,E,A,B,R,I,z,M,N,F,P,$,V,U,W,H,G,K,Y,X,Z,J,tt,et,nt,it,st,rt,at,ot,lt,ct,ut,ht,ft,pt,dt,mt,gt,bt,vt,wt,qt,xt,kt,yt,Ot,jt,Qt,Tt,Ct,Lt,St,_t,Dt,Et,At,Bt,Rt,It,zt,Mt,Nt,Ft,Pt,$t,Vt,Ut,Wt=window.jQuery,Ht=Math.min,Gt=Math.max;if(!Wt)throw"MathQuill requires jQuery 1.5.2+ to be loaded first";v=[].slice,w=e(function(t,n){return e(function(e,i){if(t in e)return e[t].apply(e,n.concat(i))})}),q=function(t,e,n){function i(t){return"object"==typeof t}function s(t){return"function"==typeof t}function r(){}return function t(n,a){function o(){var t=new l;return s(t.init)&&t.init.apply(t,arguments),t}function l(){}var c,u,h;return void 0===a&&(a=n,n=Object),o.Bare=l,c=r.prototype=n.prototype,u=l.prototype=o.prototype=o.p=new r,u.constructor=o,o.extend=function(e){return t(o,e)},(o.open=function(t){if(h={},s(t)?h=t.call(o,u,c,o,n):i(t)&&(h=t),i(h))for(var r in h)e.call(h,r)&&(u[r]=h[r]);return s(u.init)||(u.init=n),o})(a)}}(0,{}.hasOwnProperty),x=-1,k=1,y=q(Wt,function(t){t.insDirOf=function(t,e){return t===x?this.insertBefore(e.first()):this.insertAfter(e.last())},t.insAtDirEnd=function(t,e){return t===x?this.prependTo(e):this.appendTo(e)}}),O=q(function(t){t.parent=0,t[x]=0,t[k]=0,t.init=function(t,e,n){this.parent=t,this[x]=e,this[k]=n},this.copy=function(t){return O(t.parent,t[x],t[k])}}),j={},Q=!1,T=q(function(t){function e(){return i+=1}t[x]=0,t[k]=0,t.parent=0;var i=0;this.getNodeOfElement=function(t){if(t){if(!t.nodeType)throw new Error("must pass an HTMLElement to Node.getNodeOfElement");return t.mqBlockNode||t.mqCmdNode}},this.linkElementByBlockId=function(t,e){T.linkElementByBlockNode(t,j[e])},this.linkElementByBlockNode=function(t,e){t.mqBlockNode=e},this.linkElementByCmdNode=function(t,e){t.mqCmdNode=e},t.init=function(){this.id=e(),j[i]=this,a(),this.ends={},this.ends[x]=0,this.ends[k]=0},t.toString=function(){return"{{ MathQuill Node #"+this.id+" }}"},t.jQ=y(),t.jQadd=function(t){return this.jQ=this.jQ.add(t)},t.jQize=function(t){function e(t){var n,i,s,r;for(t.getAttribute&&(n=t.getAttribute("mathquill-command-id"),n&&(t.removeAttribute("mathquill-command-id"),i=j[n],i.jQadd(t),T.linkElementByCmdNode(t,i)),(s=t.getAttribute("mathquill-block-id"))&&(t.removeAttribute("mathquill-block-id"),r=j[s],r.jQadd(t),T.linkElementByBlockNode(t,r))),t=t.firstChild;t;t=t.nextSibling)e(t)}var n;for(t=y(t||this.html()),n=0;n<t.length;n+=1)e(t[n]);return t},t.createDir=function(t,e){r(t);var n=this;return n.jQize(),n.jQ.insDirOf(t,e.jQ),e[t]=n.adopt(e.parent,e[x],e[k]),n},t.createLeftOf=function(t){return this.createDir(x,t)},t.selectChildren=function(t,e){return D(t,e)},t.bubble=n(function(t){var e;for(e=this;e&&!1!==t(e);e=e.parent);return this}),t.postOrder=n(function(t){return function e(n){n.eachChild(e),t(n)}(this),this}),t.isEmpty=function(){return 0===this.ends[x]&&0===this.ends[k]},t.isStyleBlock=function(){return!1},t.children=function(){return C(this.ends[x],this.ends[k])},t.eachChild=function(){var t=this.children();return t.each.apply(t,arguments),this},t.foldChildren=function(t,e){return this.children().fold(t,e)},t.withDirAdopt=function(t,e,n,i){return C(this,this).withDirAdopt(t,e,n,i),this},t.adopt=function(t,e,n){return C(this,this).adopt(t,e,n),this},t.disown=function(){return C(this,this).disown(),this},t.remove=function(){return this.jQ.remove(),this.disown()}}),C=q(function(t){t.init=function(t,e,n){if(n===b&&(n=x),r(n),s("no half-empty fragments",!t==!e),this.ends={},t){s("withDir is passed to Fragment",t instanceof T),s("oppDir is passed to Fragment",e instanceof T),s("withDir and oppDir have the same parent",t.parent===e.parent),this.ends[n]=t,this.ends[-n]=e;var i=this.fold([],function(t,e){return t.push.apply(t,e.jQ.get()),t});this.jQ=this.jQ.add(i)}},t.jQ=y(),t.withDirAdopt=function(t,e,n,i){return t===x?this.adopt(e,n,i):this.adopt(e,i,n)},t.adopt=function(t,e,n){var i,s,r;return l(t,e,n),i=this,i.disowned=!1,(s=i.ends[x])?(r=i.ends[k],e||(t.ends[x]=s),n?n[x]=r:t.ends[k]=r,i.ends[k][k]=n,i.each(function(n){n[x]=e,n.parent=t,e&&(e[k]=n),e=n}),i):this},t.disown=function(){var t,e,n=this,i=n.ends[x];return!i||n.disowned?n:(n.disowned=!0,t=n.ends[k],e=i.parent,l(e,i[x],i),l(e,t,t[k]),i[x]?i[x][k]=t[k]:e.ends[x]=t[k],t[k]?t[k][x]=i[x]:e.ends[k]=i[x],n)},t.remove=function(){return this.jQ.remove(),this.disown()},t.each=n(function(t){var e=this,n=e.ends[x];if(!n)return e;for(;n!==e.ends[k][k]&&!1!==t(n);n=n[k]);return e}),t.fold=function(t,e){return this.each(function(n){t=e.call(this,t,n)}),t}}),L={},S={},_=q(O,function(t){t.init=function(t,e){this.parent=t,this.options=e;var n=this.jQ=this._jQ=y('<span class="mq-cursor">&#8203;</span>');this.blink=function(){n.toggleClass("mq-blink")},this.upDownCache={}},t.show=function(){return this.jQ=this._jQ.removeClass("mq-blink"),"intervalId"in this?clearInterval(this.intervalId):(this[k]?this.selection&&this.selection.ends[x][x]===this[x]?this.jQ.insertBefore(this.selection.jQ):this.jQ.insertBefore(this[k].jQ.first()):this.jQ.appendTo(this.parent.jQ),this.parent.focus()),this.intervalId=setInterval(this.blink,500),this},t.hide=function(){return"intervalId"in this&&clearInterval(this.intervalId),delete this.intervalId,this.jQ.detach(),this.jQ=y(),this},t.withDirInsertAt=function(t,e,n,i){var s=this.parent;this.parent=e,this[t]=n,this[-t]=i,s!==e&&s.blur&&s.blur(this)},t.insDirOf=function(t,e){return r(t),this.jQ.insDirOf(t,e.jQ),this.withDirInsertAt(t,e.parent,e[t],e),this.parent.jQ.addClass("mq-hasCursor"),this},t.insLeftOf=function(t){return this.insDirOf(x,t)},t.insRightOf=function(t){return this.insDirOf(k,t)},t.insAtDirEnd=function(t,e){return r(t),this.jQ.insAtDirEnd(t,e.jQ),this.withDirInsertAt(t,e,0,e.ends[t]),e.focus(),this},t.insAtLeftEnd=function(t){return this.insAtDirEnd(x,t)},t.insAtRightEnd=function(t){return this.insAtDirEnd(k,t)},t.jumpUpDown=function(t,e){var n,i,s=this;s.upDownCache[t.id]=O.copy(s),n=s.upDownCache[e.id],n?n[k]?s.insLeftOf(n[k]):s.insAtRightEnd(n.parent):(i=s.offset().left,e.seek(i,s)),U.queue(e,!0)},t.offset=function(){var t=this,e=t.jQ.removeClass("mq-cursor").offset();return t.jQ.addClass("mq-cursor"),e},t.unwrapGramp=function(){var t=this.parent.parent,e=t.parent,n=t[k],i=this,s=t[x];if(t.disown().eachChild(function(i){i.isEmpty()||(i.children().adopt(e,s,n).each(function(e){e.jQ.insertBefore(t.jQ.first())}),s=i.ends[k])}),!this[k])if(this[x])this[k]=this[x][k];else for(;!this[k];){if(this.parent=this.parent[k],!this.parent){this[k]=t[k],this.parent=e;break}this[k]=this.parent.ends[x]}this[k]?this.insLeftOf(this[k]):this.insAtRightEnd(e),t.jQ.remove(),t[x].siblingDeleted&&t[x].siblingDeleted(i.options,k),t[k].siblingDeleted&&t[k].siblingDeleted(i.options,x)},t.startSelection=function(){var t,e=this.anticursor=O.copy(this),n=e.ancestors={};for(t=e;t.parent;t=t.parent)n[t.parent.id]=t},t.endSelection=function(){delete this.anticursor},t.select=function(){var t,e,n,i,r,a,o,l=this.anticursor;if(this[x]===l[x]&&this.parent===l.parent)return!1;for(t=this;t.parent;t=t.parent)if(t.parent.id in l.ancestors){e=t.parent;break}if(s("cursor and anticursor in the same tree",e),n=l.ancestors[e.id],a=k,t[x]!==n)for(o=t;o;o=o[k])if(o[k]===n[k]){a=x,i=t,r=n;break}return a===k&&(i=n,r=t),i instanceof O&&(i=i[k]),r instanceof O&&(r=r[x]),this.hide().selection=e.selectChildren(i,r),this.insDirOf(a,this.selection.ends[a]),this.selectionChanged(),!0},t.clearSelection=function(){return this.selection&&(this.selection.clear(),delete this.selection,this.selectionChanged()),this},t.deleteSelection=function(){this.selection&&(this[x]=this.selection.ends[x][x],this[k]=this.selection.ends[k][k],this.selection.remove(),this.selectionChanged(),delete this.selection)},t.replaceSelection=function(){var t=this.selection;return t&&(this[x]=t.ends[x][x],this[k]=t.ends[k][k],delete this.selection),t}}),D=q(C,function(t,e){t.init=function(){e.init.apply(this,arguments),this.jQ=this.jQ.wrapAll('<span class="mq-selection"></span>').parent()},t.adopt=function(){return this.jQ.replaceWith(this.jQ=this.jQ.children()),e.adopt.apply(this,arguments)},t.clear=function(){return this.jQ.replaceWith(this.jQ[0].childNodes),this},t.join=function(t){return this.fold("",function(e,n){return e+n[t]()})}}),E=q(function(t){t.init=function(t,e,n){this.id=t.id,this.data={},this.root=t,this.container=e,this.options=n,this.ariaLabel="MathQuill Input",this.ariaPostLabel="",t.controller=this,this.cursor=t.cursor=_(t,n)},t.handle=function(t,e){var n,i=this.options.handlers;i&&i.fns[t]&&(n=i.APIClasses[this.KIND_OF_MQ](this),e===x||e===k?i.fns[t](e,n):i.fns[t](n))};var e=[];this.onNotify=function(t){e.push(t)},t.notify=function(){for(var t=0;t<e.length;t+=1)e[t].apply(this.cursor,arguments);return this}}),A={},B=q(),R={},I=q(),z={},u.prototype=I.p,u.VERSION="v0.10.1",u.interfaceVersion=function(t){if(1!==t)throw"Only interface version 1 supported. You specified: "+t;return c=function(){window.console&&console.warn('You called MathQuill.interfaceVersion(1); to specify the interface version, which will fail in v1.0.0. You can fix this easily by doing this before doing anything else:\n\n    MathQuill = MathQuill.getInterface(1);\n    // now MathQuill.MathField() works like it used to\n\nSee also the "`dev` branch (2014–2015) → v0.10.0 Migration Guide" at\n  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide')},c(),u},u.getInterface=h,M=h.MIN=1,N=h.MAX=2,u.noConflict=function(){return window.MathQuill=F,u},F=window.MathQuill,window.MathQuill=u,P=q(function(t,e,n){function i(t,e){throw t=t?"'"+t+"'":"EOF","Parse Error: "+e+" at "+t}var r,a,o;t.init=function(t){this._=t},t.parse=function(t){function e(t,e){return e}return this.skip(o)._(""+t,e,i)},t.or=function(t){s("or is passed a parser",t instanceof n);var e=this;return n(function(n,i,s){function r(e){return t._(n,i,s)}return e._(n,i,r)})},t.then=function(t){var e=this;return n(function(i,r,a){function o(e,i){var o=t instanceof n?t:t(i);return s("a parser is returned",o instanceof n),o._(e,r,a)}return e._(i,o,a)})},t.many=function(){var t=this;return n(function(e,n,i){function s(t,n){return e=t,a.push(n),!0}function r(){return!1}for(var a=[];t._(e,s,r););return n(e,a)})},t.times=function(t,e){arguments.length<2&&(e=t);var i=this;return n(function(n,s,r){function a(t,e){return h.push(e),n=t,!0}function o(t,e){return c=e,n=t,!1}function l(t,e){return!1}var c,u,h=[],f=!0;for(u=0;u<t;u+=1)if(!(f=i._(n,a,o)))return r(n,c);for(;u<e&&f;u+=1)f=i._(n,a,l);return s(n,h)})},t.result=function(t){return this.then(a(t))},t.atMost=function(t){return this.times(0,t)},t.atLeast=function(t){var e=this;return e.times(t).then(function(t){return e.many().map(function(e){return t.concat(e)})})},t.map=function(t){return this.then(function(e){return a(t(e))})},t.skip=function(t){return this.then(function(e){return t.result(e)})},this.string=function(t){var e=t.length,i="expected '"+t+"'";return n(function(n,s,r){var a=n.slice(0,e);return a===t?s(n.slice(e),a):r(n,i)})},r=this.regex=function(t){s("regexp parser is anchored","^"===t.toString().charAt(1));var e="expected "+t;return n(function(n,i,s){var r,a=t.exec(n);return a?(r=a[0],i(n.slice(r.length),r)):s(n,e)})},a=n.succeed=function(t){return n(function(e,n){return n(e,t)})},n.fail=function(t){return n(function(e,n,i){return i(e,t)})},n.letter=r(/^[a-z]/i),n.letters=r(/^[a-z]*/i),n.digit=r(/^[0-9]/),n.digits=r(/^[0-9]*/),n.whitespace=r(/^\s+/),n.optWhitespace=r(/^\s*/),n.any=n(function(t,e,n){return t?e(t.slice(1),t.charAt(0)):n(t,"expected any character")}),n.all=n(function(t,e,n){return e("",t)}),o=n.eof=n(function(t,e,n){return t?n(t,"expected EOF"):e(t,t)})}),$=function(){function e(t){var e,i=t.which||t.keyCode,s=n[i],r=[];return t.ctrlKey&&r.push("Ctrl"),t.originalEvent&&t.originalEvent.metaKey&&r.push("Meta"),t.altKey&&r.push("Alt"),t.shiftKey&&r.push("Shift"),e=s||String.fromCharCode(i),r.length||s?(r.push(e),r.join("-")):e}var n={8:"Backspace",9:"Tab",10:"Enter",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",144:"NumLock"};return function(n,i){function s(t){k=t,clearTimeout(g),g=setTimeout(t)}function r(e){s(function(n){k=t,clearTimeout(g),e(n)})}function a(e){k(),k=t,clearTimeout(g),q.val(e),e&&q[0].select&&q[0].select(),b=!!e}function o(){var t=q[0];return"selectionStart"in t&&t.selectionStart!==t.selectionEnd}function l(){i.keystroke(e(v),v)}function c(t){v=t,w=null,b&&r(function(t){t&&"focusout"===t.type||!q[0].select||q[0].select()}),l()}function u(t){v&&w&&l(),w=t,s(f)}function h(t){v&&!w&&s(f)}function f(){if(!o()){var t=q.val();1===t.length?(q.val(""),i.typedText(t)):t&&q[0].select&&q[0].select()}}function p(){v=w=null}function d(t){q.focus(),s(m)}function m(){var t=q.val();q.val(""),t&&i.paste(t)}var g,b,v=null,w=null,q=Wt(n),x=Wt(i.container||q),k=t;return x.bind("keydown keypress input keyup focusout paste",function(t){k(t)}),b=!1,x.bind({keydown:c,keypress:u,keyup:h,focusout:p,cut:function(){r(function(){i.cut()})},copy:function(){r(function(){i.copy()})},paste:d}),{select:a}}}(),V=q(function(t){t.init=function(){this.jQ=Wt([]),Wt(document).ready(function(){var t=".mq-aria-alert";Wt(t).length||Wt("body").append("<p aria-live='assertive' aria-atomic='true' class='mq-aria-alert'></p>"),this.jQ=Wt(t)}.bind(this)),this.items=[],this.msg=""},t.queue=function(t,e){return t instanceof T&&(t=e?t.parent&&t.parent.ariaLabel&&"block"===t.ariaLabel?t.parent.ariaLabel+" "+t.mathspeak():t.ariaLabel?t.ariaLabel+" "+t.mathspeak():t.mathspeak():t.mathspeak()),this.items.push(t),this},t.queueDirOf=function(t){return r(t),this.queue(t===x?"before":"after")},t.queueDirEndOf=function(t){return r(t),this.queue(t===x?"beginning of":"end of")},t.alert=function(t){return t&&this.queue(t),this.items.length&&(this.msg=this.items.join(" ").replace(/ +(?= )/g,"").trim(),this.jQ.empty().text(this.msg)),this.clear()},t.clear=function(){return this.items.length=0,this}}),U=V(),E.open(function(t){t.aria=U,t.exportMathSpeak=function(){return this.root.mathspeak()}}),E.open(function(t,e){t.exportText=function(){return this.root.foldChildren("",function(t,e){return t+e.text()})}}),E.open(function(t){t.focusBlurEvents=function(){function t(){clearTimeout(n),r.selection&&r.selection.jQ.addClass("mq-blur"),e()}function e(){r.hide().parent.blur(),i.container.removeClass("mq-focused"),y(window).unbind("blur",t)}var n,i=this,s=i.root,r=i.cursor;i.textarea.focus(function(){U.jQ.empty(),i.textarea.attr("aria-label",i.ariaLabel+": "+s.mathspeak()+" "+i.ariaPostLabel.trim()),i.blurred=!1,clearTimeout(n),i.container.addClass("mq-focused"),r.parent||r.insAtRightEnd(s),r.selection?(r.selection.jQ.removeClass("mq-blur"),i.selectionChanged()):r.show()}).blur(function(){U.jQ.empty(),i.textarea.attr("aria-label",i.ariaLabel+": "+s.mathspeak()+" "+i.ariaPostLabel.trim()),i.blurred=!0,n=setTimeout(function(){s.postOrder("intentionalBlur"),r.clearSelection().endSelection(),e()}),y(window).bind("blur",t)}),i.blurred=!0,r.hide().parent.blur()}}),E.open(function(t){t.keystroke=function(t,e){this.cursor.parent.keystroke(t,e,this)}}),T.open(function(t){t.keystroke=function(t,e,n){var i=n.cursor;switch(t){case"Ctrl-Shift-Backspace":case"Ctrl-Backspace":n.ctrlDeleteDir(x);break;case"Shift-Backspace":case"Backspace":n.backspace();break;case"Esc":case"Tab":return void n.escapeDir(k,t,e);case"Shift-Tab":case"Shift-Esc":return void n.escapeDir(x,t,e);case"End":n.notify("move").cursor.insAtRightEnd(i.parent),U.queue("end of").queue(i.parent,!0);break;case"Ctrl-End":n.notify("move").cursor.insAtRightEnd(n.root),U.queue("end of").queue(n.ariaLabel).queue(n.root).queue(n.ariaPostLabel);break;case"Shift-End":for(;i[k];)n.selectRight();break;case"Ctrl-Shift-End":for(;i[k]||i.parent!==n.root;)n.selectRight();break;case"Home":n.notify("move").cursor.insAtLeftEnd(i.parent),U.queue("beginning of").queue(i.parent,!0);break;case"Ctrl-Home":n.notify("move").cursor.insAtLeftEnd(n.root),U.queue("beginning of").queue(n.ariaLabel).queue(n.root).queue(n.ariaPostLabel);break;case"Shift-Home":for(;i[x];)n.selectLeft();break;case"Ctrl-Shift-Home":for(;i[x]||i.parent!==n.root;)n.selectLeft();break;case"Left":n.moveLeft();break;case"Shift-Left":n.selectLeft();break;case"Ctrl-Left":break;case"Right":n.moveRight();break;case"Shift-Right":n.selectRight();break;case"Ctrl-Right":break;case"Up":n.moveUp();break;case"Down":n.moveDown();break;case"Shift-Up":if(i[x])for(;i[x];)n.selectLeft();else n.selectLeft();case"Shift-Down":if(i[k])for(;i[k];)n.selectRight();else n.selectRight();case"Ctrl-Up":case"Ctrl-Down":break;case"Ctrl-Shift-Del":case"Ctrl-Del":n.ctrlDeleteDir(k);break;case"Shift-Del":case"Del":n.deleteForward();break;case"Meta-A":case"Ctrl-A":for(n.notify("move").cursor.insAtRightEnd(n.root);i[x];)n.selectLeft();break;case"Ctrl-Alt-Up":i.parent.parent&&i.parent.parent instanceof T?U.queue(i.parent.parent):U.queue("nothing above");break;case"Ctrl-Alt-Down":i.parent&&i.parent instanceof T?U.queue(i.parent):U.queue("block is empty");break;case"Ctrl-Alt-Left":i.parent.parent.ends[x]&&i.parent.parent.ends[x]instanceof T?U.queue(i.parent.parent.ends[x]):U.queue("nothing to the left");break;case"Ctrl-Alt-Right":i.parent.parent.ends[k]&&i.parent.parent.ends[k]instanceof T?U.queue(i.parent.parent.ends[k]):U.queue("nothing to the right");break;case"Ctrl-Alt-Shift-Down":i.selection?U.queue(i.selection.join("mathspeak")+" selected"):U.queue("nothing selected");break;default:return}U.alert(),e.preventDefault(),n.scrollHoriz()},t.moveOutOf=t.moveTowards=t.deleteOutOf=t.deleteTowards=t.unselectInto=t.selectOutOf=t.selectTowards=function(){s("overridden or never called on this node")}}),E.open(function(t){function e(t,e){var n=t.notify("upDown").cursor,i=e+"Into",s=e+"OutOf";return n[k][i]?n.insAtLeftEnd(n[k][i]):n[x][i]?n.insAtRightEnd(n[x][i]):n.parent.bubble(function(t){var e=t[s];if(e&&("function"==typeof e&&(e=t[s](n)),e instanceof T&&n.jumpUpDown(t,e),!0!==e))return!1}),t}this.onNotify(function(t){"move"!==t&&"upDown"!==t||this.show().clearSelection()}),t.escapeDir=function(t,e,n){r(t);var i=this.cursor;if(i.parent!==this.root&&n.preventDefault(),i.parent!==this.root)return i.parent.moveOutOf(t,i),U.alert(),this.notify("move")},R.leftRightIntoCmdGoes=function(t){if(t&&"up"!==t&&"down"!==t)throw'"up" or "down" required for leftRightIntoCmdGoes option, got "'+t+'"';return t},t.moveDir=function(t){r(t);var e=this.cursor,n=e.options.leftRightIntoCmdGoes;return e.selection?e.insDirOf(t,e.selection.ends[t]):e[t]?e[t].moveTowards(t,e,n):e.parent.moveOutOf(t,e,n),this.notify("move")},t.moveLeft=function(){return this.moveDir(x)},t.moveRight=function(){return this.moveDir(k)},t.moveUp=function(){return e(this,"up")},t.moveDown=function(){return e(this,"down")},this.onNotify(function(t){"upDown"!==t&&(this.upDownCache={})}),this.onNotify(function(t){"edit"===t&&this.show().deleteSelection()}),t.deleteDir=function(t){var e,n,i,s,a,o;return r(t),e=this.cursor,n=e[t],i=e.parent.parent,n&&n instanceof T?n.sides?U.queue(n.parent.chToCmd(n.sides[-t].ch).mathspeak({createdLeftOf:e})):n.blocks||U.queue(n):i&&i instanceof T&&(i.sides?U.queue(i.parent.chToCmd(i.sides[t].ch).mathspeak({createdLeftOf:e})):i.blocks&&i.mathspeakTemplate?i.upInto&&i.downInto?U.queue(i.mathspeakTemplate[1]):(s=i.mathspeakTemplate,a=t===x?s[0]:s[s.length-1],U.queue(a)):U.queue(i)),o=e.selection,this.notify("edit"),o||(e[t]?e[t].deleteTowards(t,e):e.parent.deleteOutOf(t,e)),e[x].siblingDeleted&&e[x].siblingDeleted(e.options,k),e[k].siblingDeleted&&e[k].siblingDeleted(e.options,x),e.parent.bubble("reflow"),this},t.ctrlDeleteDir=function(t){var e,n;return r(t),e=this.cursor,!e[x]||e.selection?this.deleteDir():(this.notify("edit"),n=C(e.parent.ends[x],e[x]),U.queue(n),n.remove(),e.insAtDirEnd(x,e.parent),e[x].siblingDeleted&&e[x].siblingDeleted(e.options,k),e[k].siblingDeleted&&e[k].siblingDeleted(e.options,x),e.parent.bubble("reflow"),this)},t.backspace=function(){return this.deleteDir(x)},t.deleteForward=function(){return this.deleteDir(k)},this.onNotify(function(t){"select"!==t&&this.endSelection()}),t.selectDir=function(t){var e,n=this.notify("select").cursor,i=n.selection;r(t),n.anticursor||n.startSelection(),e=n[t],e?i&&i.ends[t]===e&&n.anticursor[-t]!==e?e.unselectInto(t,n):e.selectTowards(t,n):n.parent.selectOutOf(t,n),n.clearSelection(),n.select()||n.show(),n.selection&&U.clear().queue(n.selection.join("mathspeak")+" selected")},t.selectLeft=function(){return this.selectDir(x)},t.selectRight=function(){return this.selectDir(k)}}),W=function(){function t(t){var e=Z();return t.adopt(e,0,0),e}function e(t){var e,n=t[0]||Z();for(e=1;e<t.length;e+=1)t[e].children().adopt(n,n.ends[k],0);return n}var n=P.string,i=P.regex,s=P.letter,r=P.any,a=P.optWhitespace,o=P.succeed,l=P.fail,c=s.map(function(t){return at(t)}),u=i(/^[^${}\\_^]/).map(function(t){return Y(t)}),h=i(/^[^\\a-eg-zA-Z]/).or(n("\\").then(i(/^[a-z]+/i).or(i(/^\s+/).result(" ")).or(r))).then(function(t){var e=L[t];return e?e(t).parser():l("unknown command: \\"+t)}),f=h.or(c).or(u),p=n("{").then(function(){return m}).skip(n("}")),d=a.then(p.or(f.map(t))),m=d.many().map(e).skip(a),g=n("[").then(d.then(function(t){return"]"!==t.join("latex")?o(t):l()}).many().map(e).skip(a)).skip(n("]")),b=m;return b.block=d,b.optBlock=g,b}(),E.open(function(t,e){t.exportLatex=function(){return this.root.latex().replace(/(\\[a-z]+) (?![a-z])/gi,"$1")},t.writeLatex=function(t){var e,n=this.notify("edit").cursor,i=P.all,s=P.eof,r=W.skip(s).or(i.result(!1)).parse(t);return r&&!r.isEmpty()&&(r.children().adopt(n.parent,n[x],n[k]),e=r.jQize(),e.insertBefore(n.jQ),n[x]=r.ends[k],r.finalizeInsert(n.options,n),r.ends[k][k].siblingCreated&&r.ends[k][k].siblingCreated(n.options,x),r.ends[x][x].siblingCreated&&r.ends[x][x].siblingCreated(n.options,k),n.parent.bubble("reflow")),this},t.renderLatexMath=function(t){var e,n,i=this.root,s=this.cursor,r=P.all,a=P.eof,o=W.skip(a).or(r.result(!1)).parse(t);i.eachChild("postOrder","dispose"),i.ends[x]=i.ends[k]=0,o&&o.children().adopt(i,0,0),e=i.jQ,o?(n=o.join("html"),e.html(n),i.jQize(e.children()),i.finalizeInsert(s.options)):e.empty(),delete s.selection,s.insAtRightEnd(i)},t.renderLatexText=function(t){var e,n,i,s,r,a,o,l,c,u,h=this.root,f=this.cursor;if(h.jQ.children().slice(1).remove(),h.ends[x]=h.ends[k]=0,delete f.selection,f.show().insAtRightEnd(h),e=P.regex,n=P.string,i=P.eof,s=P.all,r=n("$").then(W).skip(n("$").or(i)).map(function(t){var e,n=nt(f);return n.createBlocks(),e=n.ends[x],t.children().adopt(e,0,0),n}),a=n("\\$").result("$"),o=a.or(e(/^[^$]/)).map(Y),l=r.or(o).many(),c=l.skip(i).or(s.result(!1)).parse(t)){for(u=0;u<c.length;u+=1)c[u].adopt(h,h.ends[k],0);h.jQize().appendTo(h.jQ),h.finalizeInsert(f.options)}}}),E.open(function(e){B.p.ignoreNextMousedown=t,e.delegateMouseEvents=function(){var e=this.root.jQ;this.container.bind("mousedown.mathquill",function(n){function i(t){a=y(t.target)}function s(t){u.anticursor||u.startSelection(),c.seek(a,t.pageX,t.pageY).cursor.select(),u.selection&&U.clear().queue(u.selection.join("mathspeak")+" selected").alert(),a=b}function r(t){u.blink=h,u.selection||(c.editable?(u.show(),U.queue(u.parent).alert()):f.detach()),o.unbind("mousemove",i),y(t.target.ownerDocument).unbind("mousemove",s).unbind("mouseup",r)}var a,o=y(n.target).closest(".mq-root-block"),l=T.getNodeOfElement(o[0])||T.getNodeOfElement(e[0]),c=l.controller,u=c.cursor,h=u.blink,f=c.textareaSpan,p=c.textarea;n.preventDefault(),n.target.unselectable=!0,u.options.ignoreNextMousedown(n)||(u.options.ignoreNextMousedown=t,c.blurred&&(c.editable||o.prepend(f),p.focus()),u.blink=t,c.seek(y(n.target),n.pageX,n.pageY).cursor.startSelection(),o.mousemove(i),y(n.target.ownerDocument).mousemove(s).mouseup(r))})}}),E.open(function(t){t.seek=function(t,e,n){var i,r=this.notify("select").cursor,a=t&&t[0];return a&&((i=T.getNodeOfElement(a))||(i=T.getNodeOfElement(t.parentElement))),i||(i=this.root),s("nodeId is the id of some Node that exists",i),r.clearSelection().show(),i.seek(e,r),this.scrollHoriz(),this}}),E.open(function(t){t.scrollHoriz=function(){var t,e,n,i,s,r=this.cursor,a=r.selection,o=this.root.jQ[0].getBoundingClientRect();if(a)if(n=a.jQ[0].getBoundingClientRect(),i=n.left-(o.left+20),s=n.right-(o.right-20),a.ends[x]===r[k])if(i<0)e=i;else{if(!(s>0))return;e=n.left-s<o.left+20?i:s}else if(s>0)e=s;else{if(!(i<0))return;e=n.right-i>o.right-20?s:i}else if((t=r.jQ[0].getBoundingClientRect().left)>o.right-20)e=t-(o.right-20);else{if(!(t<o.left+20))return;e=t-(o.left+20)}this.root.jQ.stop().animate({scrollLeft:"+="+e},100)}}),E.open(function(t){B.p.substituteTextarea=function(){return y("<textarea autocapitalize=off autocomplete=off autocorrect=off spellcheck=false x-palm-disable-ste-all=true/>")[0]},t.createTextarea=function(){var t,e=this.textareaSpan=y('<span class="mq-textarea"></span>'),n=this.options.substituteTextarea()
;if(!n.nodeType)throw"substituteTextarea() must return a DOM element, got "+n;n=this.textarea=y(n).appendTo(e),t=this,t.cursor.selectionChanged=function(){t.selectionChanged()}},t.selectionChanged=function(){var t=this;xt(t.container[0]),t.textareaSelectionTimeout===b&&(t.textareaSelectionTimeout=setTimeout(function(){t.setTextareaSelection()}))},t.setTextareaSelection=function(){this.textareaSelectionTimeout=b;var t="";this.cursor.selection&&(t=this.cursor.selection.join("latex"),this.options.statelessClipboard&&(t="$"+t+"$")),this.selectFn(t)},t.staticMathTextareaEvents=function(){function t(){s.detach(),e.blurred=!0}var e=this,n=(e.root,e.cursor),i=e.textarea,s=e.textareaSpan;this.container.prepend('<span class="mq-selectable">$'+e.exportLatex()+"$</span>"),e.blurred=!0,i.bind("cut paste",!1).bind("copy",function(){e.setTextareaSelection()}).focus(function(){e.blurred=!1}).blur(function(){n.selection&&n.selection.clear(),setTimeout(t)}),e.selectFn=function(t){i.val(t),t&&i.select()}},B.p.substituteKeyboardEvents=$,t.editablesTextareaEvents=function(){var t=this,e=t.textarea,n=t.textareaSpan,i=this.options.substituteKeyboardEvents(e,this);this.selectFn=function(t){i.select(t)},this.container.prepend(n),this.focusBlurEvents()},t.typedText=function(t){if("\n"===t)return this.handle("enter");var e=this.notify().cursor;e.parent.write(e,t),this.scrollHoriz()},t.cut=function(){var t=this,e=t.cursor;e.selection&&setTimeout(function(){t.notify("edit"),e.parent.bubble("reflow")})},t.copy=function(){this.setTextareaSelection()},t.paste=function(t){this.options.statelessClipboard&&(t="$"===t.slice(0,1)&&"$"===t.slice(-1)?t.slice(1,-1):"\\text{"+t+"}"),this.writeLatex(t).cursor.show()}}),H=q(T,function(t,e){t.finalizeInsert=function(t,e){var n=this;n.postOrder("finalizeTree",t),n.postOrder("contactWeld",e),n.postOrder("blur"),n.postOrder("reflow"),n[k].siblingCreated&&n[k].siblingCreated(t,x),n[x].siblingCreated&&n[x].siblingCreated(t,k),n.bubble("reflow")}}),G=q(H,function(t,e){t.init=function(t,n,i){var s=this;e.init.call(s),s.ctrlSeq||(s.ctrlSeq=t),n&&(s.htmlTemplate=n),i&&(s.textTemplate=i)},t.replaces=function(t){t.disown(),this.replacedFragment=t},t.isEmpty=function(){return this.foldChildren(!0,function(t,e){return t&&e.isEmpty()})},t.parser=function(){var t=W.block,e=this;return t.times(e.numBlocks()).map(function(t){e.blocks=t;for(var n=0;n<t.length;n+=1)t[n].adopt(e,e.ends[k],0);return e})},t.createLeftOf=function(t){var n=this,i=n.replacedFragment;n.createBlocks(),e.createLeftOf.call(n,t),i&&(i.adopt(n.ends[x],0,0),i.jQ.appendTo(n.ends[x].jQ)),n.finalizeInsert(t.options),n.placeCursor(t)},t.createBlocks=function(){var t,e,n=this,i=n.numBlocks(),s=n.blocks=Array(i);for(t=0;t<i;t+=1)e=s[t]=Z(),e.adopt(n,n.ends[k],0)},t.placeCursor=function(t){t.insAtRightEnd(this.foldChildren(this.ends[x],function(t,e){return t.isEmpty()?t:e}))},t.moveTowards=function(t,e,n){var i=n&&this[n+"Into"];e.insAtDirEnd(-t,i||this.ends[-t]),U.queueDirEndOf(-t).queue(e.parent,!0)},t.deleteTowards=function(t,e){this.isEmpty()?e[t]=this.remove()[t]:this.moveTowards(t,e,null)},t.selectTowards=function(t,e){e[-t]=this,e[t]=this[t]},t.selectChildren=function(){return D(this,this)},t.unselectInto=function(t,e){e.insAtDirEnd(-t,e.anticursor.ancestors[this.id])},t.seek=function(t,e){function n(t){var e={};return e[x]=t.jQ.offset().left,e[k]=e[x]+t.jQ.outerWidth(),e}var i,s=this,r=n(s);return t<r[x]?e.insLeftOf(s):t>r[k]?e.insRightOf(s):(i=r[x],void s.eachChild(function(a){var o=n(a);return t<o[x]?(t-i<o[x]-t?a[x]?e.insAtRightEnd(a[x]):e.insLeftOf(s):e.insAtLeftEnd(a),!1):t>o[k]?void(a[k]?i=o[k]:r[k]-t<t-o[k]?e.insRightOf(s):e.insAtRightEnd(a)):(a.seek(t,e),!1)}))},t.numBlocks=function(){var t=this.htmlTemplate.match(/&\d+/g);return t?t.length:0},t.html=function(){var t,e,n,i=this,r=i.blocks,a=" mathquill-command-id="+i.id,o=i.htmlTemplate.match(/<[^<>]+>|[^<>]+/g);for(s("no unmatched angle brackets",o.join("")===this.htmlTemplate),t=0,e=o[0];e;t+=1,e=o[t])if("/>"===e.slice(-2))o[t]=e.slice(0,-2)+a+"/>";else if("<"===e.charAt(0)){s("not an unmatched top-level close tag","/"!==e.charAt(1)),o[t]=e.slice(0,-1)+a+">",n=1;do{t+=1,e=o[t],s("no missing close tags",e),"</"===e.slice(0,2)?n-=1:"<"===e.charAt(0)&&"/>"!==e.slice(-2)&&(n+=1)}while(n>0)}return o.join("").replace(/>&(\d+)/g,function(t,e){return" mathquill-block-id="+r[e].id+">"+r[e].join("html")})},t.latex=function(){return this.foldChildren(this.ctrlSeq,function(t,e){return t+"{"+(e.latex()||" ")+"}"})},t.textTemplate=[""],t.text=function(){var t=this,e=0;return t.foldChildren(t.textTemplate[e],function(n,i){e+=1;var s=i.text();return n&&"("===t.textTemplate[e]&&"("===s[0]&&")"===s.slice(-1)?n+s.slice(1,-1)+t.textTemplate[e]:n+i.text()+(t.textTemplate[e]||"")})},t.mathspeakTemplate=[],t.mathspeak=function(){var t=this,e=0;return t.foldChildren(t.mathspeakTemplate[e]||"Start"+t.ctrlSeq+" ",function(n,i){return e+=1,n+" "+i.mathspeak()+" "+(t.mathspeakTemplate[e]+" "||"End"+t.ctrlSeq+" ")})}}),K=q(G,function(e,n){e.init=function(t,e,i,s){i||(i=t&&t.length>1?t.slice(1):t),this.mathspeakName=s||i,n.init.call(this,t,e,[i])},e.parser=function(){return P.succeed(this)},e.numBlocks=function(){return 0},e.replaces=function(t){t.remove()},e.createBlocks=t,e.moveTowards=function(t,e){e.jQ.insDirOf(t,this.jQ),e[-t]=this,e[t]=this[t],U.queue(this)},e.deleteTowards=function(t,e){e[t]=this.remove()[t]},e.seek=function(t,e){t-this.jQ.offset().left<this.jQ.outerWidth()/2?e.insLeftOf(this):e.insRightOf(this)},e.latex=function(){return this.ctrlSeq},e.text=function(){return this.textTemplate.join("")},e.mathspeak=function(){return this.mathspeakName},e.placeCursor=t,e.isEmpty=function(){return!0}}),Y=q(K,function(t,e){t.init=function(t,n,i){e.init.call(this,t,"<span>"+(n||t)+"</span>",b,i)}}),X=q(K,function(t,e){t.init=function(t,n,i,s){e.init.call(this,t,'<span class="mq-binary-operator">'+n+"</span>",i,s)}}),Z=q(H,function(t,e){t.join=function(t){return this.foldChildren("",function(e,n){return e+n[t]()})},t.html=function(){return this.join("html")},t.latex=function(){return this.join("latex")},t.text=function(){return this.ends[x]===this.ends[k]&&0!==this.ends[x]?this.ends[x].text():this.join("text")},t.mathspeak=function(){var t="",e={};return this.controller&&(e=this.controller.options.autoOperatorNames),this.foldChildren([],function(n,i){var s,r;return!1===i.isItalic?t+=i.mathspeak():(""!==t&&(e!=={}&&e._maxLength>0&&"string"==typeof(s=e[t.toLowerCase()])&&(t=s),n.push(t+" "),t=""),r=i.mathspeak(),/^[A-Za-z]*$/.test(i.text())?r='"'+r+'"':isNaN(i.text())&&(r=" "+r,"."!==i.text()&&(r+=" ")),n.push(r.replace(/ +(?= )/g,""))),n}).join("")},t.ariaLabel="block",t.keystroke=function(t,n,i){return!i.options.spaceBehavesLikeTab||"Spacebar"!==t&&"Shift-Spacebar"!==t?e.keystroke.apply(this,arguments):(n.preventDefault(),void i.escapeDir("Shift-Spacebar"===t?x:k,t,n))},t.moveOutOf=function(t,e,n){n&&this.parent[n+"Into"]||!this[t]?(e.insDirOf(t,this.parent),U.queueDirOf(t).queue(this.parent)):(e.insAtDirEnd(-t,this[t]),U.queueDirEndOf(-t).queue(e.parent,!0))},t.selectOutOf=function(t,e){e.insDirOf(t,this.parent)},t.deleteOutOf=function(t,e){e.unwrapGramp()},t.seek=function(t,e){var n=this.ends[k];if(!n||n.jQ.offset().left+n.jQ.outerWidth()<t)return e.insAtRightEnd(this);if(t<this.ends[x].jQ.offset().left)return e.insAtLeftEnd(this);for(;t<n.jQ.offset().left;)n=n[x];return n.seek(t,e)},t.chToCmd=function(t,e){var n;return t.match(/^[a-eg-zA-Z]$/)?at(t):/^\d$/.test(t)?st(t):e&&e.typingSlashWritesDivisionSymbol&&"/"===t?L["÷"](t):e&&e.typingAsteriskWritesTimesSymbol&&"*"===t?L["×"](t):(n=S[t]||L[t])?n(t):Y(t)},t.write=function(t,e){var n=this.chToCmd(e,t.options);t.selection&&n.replaces(t.replaceSelection()),n.createLeftOf(t.show()),"/"===e?U.alert("over"):U.alert(n.mathspeak({createdLeftOf:t}))},t.focus=function(){return this.jQ.addClass("mq-hasCursor"),this.jQ.removeClass("mq-empty"),this},t.blur=function(){return this.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.jQ.addClass("mq-empty"),this}}),A.StaticMath=function(t){return q(t.AbstractMathQuill,function(e,n){this.RootBlock=Z,e.__mathquillify=function(t,e){return this.config(t),n.__mathquillify.call(this,"mq-math-mode"),this.__controller.delegateMouseEvents(),this.__controller.staticMathTextareaEvents(),this},e.init=function(){n.init.apply(this,arguments),this.__controller.root.postOrder("registerInnerField",this.innerFields=[],t.MathField)},e.latex=function(){var e=n.latex.apply(this,arguments);return arguments.length>0&&this.__controller.root.postOrder("registerInnerField",this.innerFields=[],t.MathField),e}})},J=q(Z,f),A.MathField=function(e){return q(e.EditableField,function(e,n){this.RootBlock=J,e.__mathquillify=function(e,i){return this.config(e),i>1&&(this.__controller.root.reflow=t),n.__mathquillify.call(this,"mq-editable-field mq-math-mode"),delete this.__controller.root.reflow,this}})},tt=q(T,function(t,e){function n(t){var e,n;if(t.jQ[0].normalize(),e=t.jQ[0].firstChild)return s("only node in TextBlock span is Text node",3===e.nodeType),n=et(e.data),n.jQadd(e),t.children().disown(),n.adopt(t,0,0)}t.ctrlSeq="\\text",t.replaces=function(t){t instanceof C?this.replacedText=t.remove().jQ.text():"string"==typeof t&&(this.replacedText=t)},t.jQadd=function(t){e.jQadd.call(this,t),this.ends[x]&&this.ends[x].jQadd(this.jQ[0].firstChild)},t.createLeftOf=function(t){var n=this;e.createLeftOf.call(this,t),n[k].siblingCreated&&n[k].siblingCreated(t.options,x),n[x].siblingCreated&&n[x].siblingCreated(t.options,k),n.bubble("reflow"),t.insAtRightEnd(n),n.replacedText&&n.write(t,n.replacedText)},t.parser=function(){var t=this,e=P.string,n=P.regex;return P.optWhitespace.then(e("{")).then(n(/^[^}]*/)).skip(e("}")).map(function(e){return 0===e.length?C():(et(e).adopt(t,0,0),t)})},t.textContents=function(){return this.foldChildren("",function(t,e){return t+e.text})},t.text=function(){return'"'+this.textContents()+'"'},t.latex=function(){var t=this.textContents();return 0===t.length?"":"\\text{"+t+"}"},t.html=function(){return'<span class="mq-text-mode" mathquill-command-id='+this.id+">"+this.textContents()+"</span>"},t.mathspeak=function(){return{speech:this.text()}},t.moveTowards=function(t,e){e.insAtDirEnd(-t,this)},t.moveOutOf=function(t,e){e.insDirOf(t,this)},t.unselectInto=t.moveTowards,t.selectTowards=G.prototype.selectTowards,t.deleteTowards=G.prototype.deleteTowards,t.selectOutOf=function(t,e){e.insDirOf(t,this)},t.deleteOutOf=function(t,e){this.isEmpty()&&e.insRightOf(this)},t.write=function(t,n){var i,s;t.show().deleteSelection(),"$"!==n?t[x]?t[x].appendText(n):et(n).createLeftOf(t):this.isEmpty()?(t.insRightOf(this),Y("\\$","$").createLeftOf(t)):t[k]?t[x]?(i=tt(),s=this.ends[x],s.disown().jQ.detach(),s.adopt(i,0,0),t.insLeftOf(this),e.createLeftOf.call(i,t)):t.insLeftOf(this):t.insRightOf(this),U.alert(n)},t.seek=function(t,e){var i,s,r,a,o,l,c,u;for(e.hide(),i=n(this),s=this.jQ.width()/this.text.length,r=Math.round((t-this.jQ.offset().left)/s),r<=0?e.insAtLeftEnd(this):r>=i.text.length?e.insAtRightEnd(this):e.insLeftOf(i.splitRight(r)),a=t-e.show().offset().left,o=a&&a<0?x:k,l=o;e[o]&&a*l>0;)e[o].moveTowards(o,e),l=a,a=t-e.offset().left;o*a<-o*l&&e[-o].moveTowards(-o,e),e.anticursor?e.anticursor.parent===this&&(c=e[x]&&e[x].text.length,this.anticursorPosition===c?e.anticursor=O.copy(e):(this.anticursorPosition<c?(u=e[x].splitRight(this.anticursorPosition),e[x]=u):u=e[k].splitRight(this.anticursorPosition-c),e.anticursor=O(this,u[x],u))):this.anticursorPosition=e[x]&&e[x].text.length},t.blur=function(t){Z.prototype.blur.call(this),t&&(""===this.textContents()?(this.remove(),t[x]===this?t[x]=this[x]:t[k]===this&&(t[k]=this[k])):n(this))},t.focus=Z.prototype.focus}),et=q(T,function(t,e){function n(t,e){return e.charAt(t===x?0:-1+e.length)}t.init=function(t){e.init.call(this),this.text=t},t.jQadd=function(t){this.dom=t,this.jQ=y(t)},t.jQize=function(){return this.jQadd(document.createTextNode(this.text))},t.appendText=function(t){this.text+=t,this.dom.appendData(t)},t.prependText=function(t){this.text=t+this.text,this.dom.insertData(0,t)},t.insTextAtDirEnd=function(t,e){r(e),e===k?this.appendText(t):this.prependText(t)},t.splitRight=function(t){var e=et(this.text.slice(t)).adopt(this.parent,this,this[k]);return e.jQadd(this.dom.splitText(t)),this.text=this.text.slice(0,t),e},t.moveTowards=function(t,e){var i,s;return r(t),i=n(-t,this.text),s=this[-t],s?s.insTextAtDirEnd(i,t):et(i).createDir(-t,e),this.deleteTowards(t,e)},t.mathspeak=t.latex=function(){return this.text},t.deleteTowards=function(t,e){this.text.length>1?t===k?(this.dom.deleteData(0,1),this.text=this.text.slice(1)):(this.dom.deleteData(-1+this.text.length,1),this.text=this.text.slice(0,-1)):(this.remove(),this.jQ.remove(),e[t]=this[t])},t.selectTowards=function(t,e){var i,s,a,o;return r(t),i=e.anticursor,s=n(-t,this.text),i[t]===this?(a=et(s).createDir(t,e),i[t]=a,e.insDirOf(t,a)):(o=this[-t],o?o.insTextAtDirEnd(s,t):(a=et(s).createDir(-t,e),a.jQ.insDirOf(-t,e.selection.jQ)),1===this.text.length&&i[-t]===this&&(i[-t]=this[-t])),this.deleteTowards(t,e)}}),L.text=L.textnormal=L.textrm=L.textup=L.textmd=tt,L.em=L.italic=L.italics=L.emph=L.textit=L.textsl=p("\\textit","i",'class="mq-text-mode"'),L.strong=L.bold=L.textbf=p("\\textbf","b",'class="mq-text-mode"'),L.sf=L.textsf=p("\\textsf","span",'class="mq-sans-serif mq-text-mode"'),L.tt=L.texttt=p("\\texttt","span",'class="mq-monospace mq-text-mode"'),L.textsc=p("\\textsc","span",'style="font-variant:small-caps" class="mq-text-mode"'),L.uppercase=p("\\uppercase","span",'style="text-transform:uppercase" class="mq-text-mode"'),L.lowercase=p("\\lowercase","span",'style="text-transform:lowercase" class="mq-text-mode"'),nt=q(G,function(t,e){t.init=function(t){e.init.call(this,"$"),this.cursor=t},t.htmlTemplate='<span class="mq-math-mode">&0</span>',t.createBlocks=function(){e.createBlocks.call(this),this.ends[x].cursor=this.cursor,this.ends[x].write=function(t,e){"$"!==e?Z.prototype.write.call(this,t,e):this.isEmpty()?(t.insRightOf(this.parent),this.parent.deleteTowards(dir,t),Y("\\$","$").createLeftOf(t.show())):t[k]?t[x]?Z.prototype.write.call(this,t,e):t.insLeftOf(this.parent):t.insRightOf(this.parent)}},t.latex=function(){return"$"+this.ends[x].latex()+"$"}}),it=q(J,function(t,e){t.keystroke=function(t){if("Spacebar"!==t&&"Shift-Spacebar"!==t)return e.keystroke.apply(this,arguments)},t.write=function(t,e){if(t.show().deleteSelection(),"$"===e)nt(t).createLeftOf(t);else{var n;"<"===e?n="&lt;":">"===e&&(n="&gt;"),Y(e,n).createLeftOf(t)}}}),A.TextField=function(t){return q(t.EditableField,function(t,e){this.RootBlock=it,t.__mathquillify=function(){return e.__mathquillify.call(this,"mq-editable-field mq-text-mode")},t.latex=function(t){return arguments.length>0?(this.__controller.renderLatexText(t),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()}})},L.notin=L.cong=L.equiv=L.oplus=L.otimes=q(X,function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}}),L["≠"]=L.ne=L.neq=i(X,"\\ne ","&ne;","not equal"),L["∗"]=L.ast=L.star=L.loast=L.lowast=i(X,"\\ast ","&lowast;","low asterisk"),L.therefor=L.therefore=i(X,"\\therefore ","&there4;","therefore"),L.cuz=L.because=i(X,"\\because ","&#8757;","because"),L.prop=L.propto=i(X,"\\propto ","&prop;","proportional to"),L["≈"]=L.asymp=L.approx=i(X,"\\approx ","&asymp;"),L.isin=L.in=i(X,"\\in ","&isin;","is in"),L.ni=L.contains=i(X,"\\ni ","&ni;","is not in"),L.notni=L.niton=L.notcontains=L.doesnotcontain=i(X,"\\not\\ni ","&#8716;","does not contain"),L.sub=L.subset=i(X,"\\subset ","&sub;","subset"),L.sup=L.supset=L.superset=i(X,"\\supset ","&sup;","superset"),L.nsub=L.notsub=L.nsubset=L.notsubset=i(X,"\\not\\subset ","&#8836;","not a subset"),L.nsup=L.notsup=L.nsupset=L.notsupset=L.nsuperset=L.notsuperset=i(X,"\\not\\supset ","&#8837;","not a superset"),L.sube=L.subeq=L.subsete=L.subseteq=i(X,"\\subseteq ","&sube;","subset or equal to"),L.supe=L.supeq=L.supsete=L.supseteq=L.supersete=L.superseteq=i(X,"\\supseteq ","&supe;","superset or equal to"),L.nsube=L.nsubeq=L.notsube=L.notsubeq=L.nsubsete=L.nsubseteq=L.notsubsete=L.notsubseteq=i(X,"\\not\\subseteq ","&#8840;","not subset or equal to"),L.nsupe=L.nsupeq=L.notsupe=L.notsupeq=L.nsupsete=L.nsupseteq=L.notsupsete=L.notsupseteq=L.nsupersete=L.nsuperseteq=L.notsupersete=L.notsuperseteq=i(X,"\\not\\supseteq ","&#8841;","not superset or equal to"),L.N=L.naturals=L.Naturals=i(Y,"\\mathbb{N}","&#8469;","naturals"),L.P=L.primes=L.Primes=L.projective=L.Projective=L.probability=L.Probability=i(Y,"\\mathbb{P}","&#8473;","P"),L.Z=L.integers=L.Integers=i(Y,"\\mathbb{Z}","&#8484;","integers"),L.Q=L.rationals=L.Rationals=i(Y,"\\mathbb{Q}","&#8474;","rationals"),L.R=L.reals=L.Reals=i(Y,"\\mathbb{R}","&#8477;","reals"),L.C=L.complex=L.Complex=L.complexes=L.Complexes=L.complexplane=L.Complexplane=L.ComplexPlane=i(Y,"\\mathbb{C}","&#8450;","complexes"),L.H=L.Hamiltonian=L.quaternions=L.Quaternions=i(Y,"\\mathbb{H}","&#8461;","quaternions"),L.quad=L.emsp=i(Y,"\\quad ","    ","4 spaces"),L.qquad=i(Y,"\\qquad ","        ","8 spaces"),L.diamond=i(Y,"\\diamond ","&#9671;","diamond"),L.bigtriangleup=i(Y,"\\bigtriangleup ","&#9651;","triangle up"),L.ominus=i(Y,"\\ominus ","&#8854;","o minus"),L.uplus=i(Y,"\\uplus ","&#8846;","disjoint union"),L.bigtriangledown=i(Y,"\\bigtriangledown ","&#9661;","triangle down"),L.sqcap=i(Y,"\\sqcap ","&#8851;","greatest lower bound"),L.triangleleft=i(Y,"\\triangleleft ","&#8882;","triangle left"),L.sqcup=i(Y,"\\sqcup ","&#8852;","least upper bound"),L.triangleright=i(Y,"\\triangleright ","&#8883;","triangle right"),L.odot=L.circledot=i(Y,"\\odot ","&#8857;","circle dot"),L.bigcirc=i(Y,"\\bigcirc ","&#9711;","circle"),L.dagger=i(Y,"\\dagger ","&#0134;","dagger"),L.ddagger=i(Y,"\\ddagger ","&#135;","big dagger"),L.wr=i(Y,"\\wr ","&#8768;","wreath"),L.amalg=i(Y,"\\amalg ","&#8720;","amalgam"),L.models=i(Y,"\\models ","&#8872;","models"),L.prec=i(Y,"\\prec ","&#8826;","precedes"),L.succ=i(Y,"\\succ ","&#8827;","succeeds"),L.preceq=i(Y,"\\preceq ","&#8828;","precedes or equals"),L.succeq=i(Y,"\\succeq ","&#8829;","succeeds or equals"),L.simeq=i(Y,"\\simeq ","&#8771;","similar or equal to"),L.mid=i(Y,"\\mid ","&#8739;","divides"),L.ll=i(Y,"\\ll ","&#8810;","ll"),L.gg=i(Y,"\\gg ","&#8811;","gg"),L.parallel=i(Y,"\\parallel ","&#8741;","parallel with"),L.nparallel=i(Y,"\\nparallel ","&#8742;","not parallel with"),L.bowtie=i(Y,"\\bowtie ","&#8904;","bowtie"),L.sqsubset=i(Y,"\\sqsubset ","&#8847;","square subset"),L.sqsupset=i(Y,"\\sqsupset ","&#8848;","square superset"),L.smile=i(Y,"\\smile ","&#8995;","smile"),L.sqsubseteq=i(Y,"\\sqsubseteq ","&#8849;","square subset or equal to"),L.sqsupseteq=i(Y,"\\sqsupseteq ","&#8850;","square superset or equal to"),L.doteq=i(Y,"\\doteq ","&#8784;","dotted equals"),L.frown=i(Y,"\\frown ","&#8994;","frown"),L.vdash=i(Y,"\\vdash ","&#8870;","v dash"),L.dashv=i(Y,"\\dashv ","&#8867;","dash v"),L.nless=i(Y,"\\nless ","&#8814;","not less than"),L.ngtr=i(Y,"\\ngtr ","&#8815;","not greater than"),L.longleftarrow=i(Y,"\\longleftarrow ","&#8592;","left arrow"),L.longrightarrow=i(Y,"\\longrightarrow ","&#8594;","right arrow"),L.Longleftarrow=i(Y,"\\Longleftarrow ","&#8656;","left arrow"),L.Longrightarrow=i(Y,"\\Longrightarrow ","&#8658;","right arrow"),L.longleftrightarrow=i(Y,"\\longleftrightarrow ","&#8596;","left and right arrow"),L.updownarrow=i(Y,"\\updownarrow ","&#8597;","up and down arrow"),L.Longleftrightarrow=i(Y,"\\Longleftrightarrow ","&#8660;","left and right arrow"),L.Updownarrow=i(Y,"\\Updownarrow ","&#8661;","up and down arrow"),L.mapsto=i(Y,"\\mapsto ","&#8614;","maps to"),L.nearrow=i(Y,"\\nearrow ","&#8599;","northeast arrow"),L.hookleftarrow=i(Y,"\\hookleftarrow ","&#8617;","hook left arrow"),L.hookrightarrow=i(Y,"\\hookrightarrow ","&#8618;","hook right arrow"),L.searrow=i(Y,"\\searrow ","&#8600;","southeast arrow"),L.leftharpoonup=i(Y,"\\leftharpoonup ","&#8636;","left harpoon up"),L.rightharpoonup=i(Y,"\\rightharpoonup ","&#8640;","right harpoon up"),L.swarrow=i(Y,"\\swarrow ","&#8601;","southwest arrow"),L.leftharpoondown=i(Y,"\\leftharpoondown ","&#8637;","left harpoon down"),L.rightharpoondown=i(Y,"\\rightharpoondown ","&#8641;","right harpoon down"),L.nwarrow=i(Y,"\\nwarrow ","&#8598;","northwest arrow"),L.ldots=i(Y,"\\ldots ","&#8230;","l dots"),L.cdots=i(Y,"\\cdots ","&#8943;","c dots"),L.vdots=i(Y,"\\vdots ","&#8942;","v dots"),L.ddots=i(Y,"\\ddots ","&#8945;","d dots"),L.surd=i(Y,"\\surd ","&#8730;","unresolved root"),L.triangle=i(Y,"\\triangle ","&#9651;","triangle"),L.ell=i(Y,"\\ell ","&#8467;","ell"),L.top=i(Y,"\\top ","&#8868;","top"),L.flat=i(Y,"\\flat ","&#9837;","flat"),L.natural=i(Y,"\\natural ","&#9838;","natural"),L.sharp=i(Y,"\\sharp ","&#9839;","sharp"),L.wp=i(Y,"\\wp ","&#8472;","wp"),L.bot=i(Y,"\\bot ","&#8869;","bot"),L.clubsuit=i(Y,"\\clubsuit ","&#9827;","club suit"),L.diamondsuit=i(Y,"\\diamondsuit ","&#9826;","diamond suit"),L.heartsuit=i(Y,"\\heartsuit ","&#9825;","heart suit"),L.spadesuit=i(Y,"\\spadesuit ","&#9824;","spade suit"),L.parallelogram=i(Y,"\\parallelogram ","&#9649;","parallelogram"),L.square=i(Y,"\\square ","&#11036;","square"),L.oint=i(Y,"\\oint ","&#8750;","o int"),L.bigcap=i(Y,"\\bigcap ","&#8745;","big cap"),L.bigcup=i(Y,"\\bigcup ","&#8746;","big cup"),L.bigsqcup=i(Y,"\\bigsqcup ","&#8852;","big square cup"),L.bigvee=i(Y,"\\bigvee ","&#8744;","big vee"),L.bigwedge=i(Y,"\\bigwedge ","&#8743;","big wedge"),L.bigodot=i(Y,"\\bigodot ","&#8857;","big o dot"),L.bigotimes=i(Y,"\\bigotimes ","&#8855;","big o times"),L.bigoplus=i(Y,"\\bigoplus ","&#8853;","big o plus"),L.biguplus=i(Y,"\\biguplus ","&#8846;","big u plus"),L.lfloor=i(Y,"\\lfloor ","&#8970;","left floor"),L.rfloor=i(Y,"\\rfloor ","&#8971;","right floor"),L.lceil=i(Y,"\\lceil ","&#8968;","left ceiling"),L.rceil=i(Y,"\\rceil ","&#8969;","right ceiling"),L.opencurlybrace=L.lbrace=i(Y,"\\lbrace ","{","left brace"),L.closecurlybrace=L.rbrace=i(Y,"\\rbrace ","}","right brace"),L.lbrack=i(Y,"[","left bracket"),L.rbrack=i(Y,"]","right bracket"),L.slash=i(Y,"/","slash"),L.vert=i(Y,"|","vertical bar"),L.perp=L.perpendicular=i(Y,"\\perp ","&perp;","perpendicular"),L.nabla=L.del=i(Y,"\\nabla ","&nabla;"),L.hbar=i(Y,"\\hbar ","&#8463;","horizontal bar"),L.AA=L.Angstrom=L.angstrom=i(Y,"\\text\\AA ","&#8491;","AA"),L.ring=L.circ=L.circle=i(Y,"\\circ ","&#8728;","circle"),L.bull=L.bullet=i(Y,"\\bullet ","&bull;","bullet"),L.setminus=L.smallsetminus=i(Y,"\\setminus ","&#8726;","set minus"),L.not=L["¬"]=L.neg=i(Y,"\\neg ","&not;","not"),L["…"]=L.dots=L.ellip=L.hellip=L.ellipsis=L.hellipsis=i(Y,"\\dots ","&hellip;","ellipsis"),L.converges=L.darr=L.dnarr=L.dnarrow=L.downarrow=i(Y,"\\downarrow ","&darr;","converges with"),L.dArr=L.dnArr=L.dnArrow=L.Downarrow=i(Y,"\\Downarrow ","&dArr;","down arrow"),L.diverges=L.uarr=L.uparrow=i(Y,"\\uparrow ","&uarr;","diverges from"),L.uArr=L.Uparrow=i(Y,"\\Uparrow ","&uArr;","up arrow"),L.to=i(X,"\\to ","&rarr;","to"),L.rarr=L.rightarrow=i(Y,"\\rightarrow ","&rarr;","right arrow"),L.implies=i(X,"\\Rightarrow ","&rArr;","implies"),L.rArr=L.Rightarrow=i(Y,"\\Rightarrow ","&rArr;","right arrow"),L.gets=i(X,"\\gets ","&larr;","gets"),L.larr=L.leftarrow=i(Y,"\\leftarrow ","&larr;","left arrow"),L.impliedby=i(X,"\\Leftarrow ","&lArr;","implied by"),L.lArr=L.Leftarrow=i(Y,"\\Leftarrow ","&lArr;","left arrow"),L.harr=L.lrarr=L.leftrightarrow=i(Y,"\\leftrightarrow ","&harr;","left and right arrow"),L.iff=i(X,"\\Leftrightarrow ","&hArr;","if and only if"),L.hArr=L.lrArr=L.Leftrightarrow=i(Y,"\\Leftrightarrow ","&hArr;","left and right arrow"),L.Re=L.Real=L.real=i(Y,"\\Re ","&real;","real"),L.Im=L.imag=L.image=L.imagin=L.imaginary=L.Imaginary=i(Y,"\\Im ","&image;","imaginary"),L.part=L.partial=i(Y,"\\partial ","&part;","partial"),L.infty=L.infin=L.infinity=i(Y,"\\infty ","&infin;","infinity"),L.alef=L.alefsym=L.aleph=L.alephsym=i(Y,"\\aleph ","&alefsym;","alef sym"),L.xist=L.xists=L.exist=L.exists=i(Y,"\\exists ","&exist;","there exists at least 1"),L.nexists=L.nexist=i(Y,"\\nexists ","&#8708;","there is no"),L.and=L.land=L.wedge=i(Y,"\\wedge ","&and;","and"),L.or=L.lor=L.vee=i(Y,"\\vee ","&or;","or"),L.o=L.O=L.empty=L.emptyset=L.oslash=L.Oslash=L.nothing=L.varnothing=i(X,"\\varnothing ","&empty;","nothing"),L.cup=L.union=i(X,"\\cup ","&cup;","union"),L.cap=L.intersect=L.intersection=i(X,"\\cap ","&cap;","intersection"),L.deg=L.degree=i(Y,"\\degree ","&deg;","degrees"),L.ang=L.angle=i(Y,"\\angle ","&ang;","angle"),L.measuredangle=i(Y,"\\measuredangle ","&#8737;","measured angle"),st=q(Y,function(t,e){t.createLeftOf=function(t){t.options.autoSubscriptNumerals&&t.parent!==t.parent.parent.sub&&(t[x]instanceof rt&&!1!==t[x].isItalic||t[x]instanceof Ct&&t[x][x]instanceof rt&&!1!==t[x][x].isItalic)?(L._().createLeftOf(t),e.createLeftOf.call(this,t),t.insRightOf(t.parent.parent)):e.createLeftOf.call(this,t)},t.mathspeak=function(t){if(t&&t.createdLeftOf){var n=t.createdLeftOf;if(n.options.autoSubscriptNumerals&&n.parent!==n.parent.parent.sub&&(n[x]instanceof rt&&!1!==n[x].isItalic||n[x]instanceof Ct&&n[x][x]instanceof rt&&!1!==n[x][x].isItalic))return"Subscript "+e.mathspeak.call(this)+" Baseline"}return e.mathspeak.apply(this,arguments)}}),rt=q(K,function(t,e){t.init=function(t,n){e.init.call(this,t,"<var>"+(n||t)+"</var>")},t.text=function(){var t=this.ctrlSeq;return this.isPartOfOperator?"\\"==t[0]?t=t.slice(1,t.length):" "==t[t.length-1]&&(t=t.slice(0,-1)):(!this[x]||this[x]instanceof rt||this[x]instanceof X||"\\ "===this[x].ctrlSeq||(t="*"+t),!this[k]||this[k]instanceof X||this[k]instanceof Ct||(t+="*")),t}}),B.p.autoCommands={_maxLength:0},R.autoCommands=function(t){var e,n,i,s,r;if(!/^[a-z]+(?: [a-z]+)*$/i.test(t))throw'"'+t+'" not a space-delimited list of only letters';for(e=t.split(" "),n={},i=0,s=0;s<e.length;s+=1){if(r=e[s],r.length<2)throw'autocommand "'+r+'" not minimum length of 2';if(L[r]===ut)throw'"'+r+'" is a built-in operator name';n[r]=1,i=Gt(i,r.length)}return n._maxLength=i,n},at=q(rt,function(t,e){function n(t){return!t||t instanceof X||t instanceof Lt}t.init=function(t){return e.init.call(this,this.letter=t)},t.createLeftOf=function(t){var n,i,s,r,a;if(e.createLeftOf.apply(this,arguments),n=t.options.autoCommands,i=n._maxLength,i>0){for(s="",r=this,a=0;r instanceof at&&r.ctrlSeq===r.letter&&a<i;)s=r.letter+s,r=r[x],a+=1;for(;s.length;){if(n.hasOwnProperty(s)){for(a=1,r=this;a<s.length;a+=1,r=r[x]);return C(r,this).remove(),t[x]=r[x],L[s](s).createLeftOf(t)}s=s.slice(1)}}},t.italicize=function(t){return this.isItalic=t,this.isPartOfOperator=!t,this.jQ.toggleClass("mq-operator-name",!t),this},t.finalizeTree=t.siblingDeleted=t.siblingCreated=function(t,e){e!==x&&this[k]instanceof at||this.autoUnItalicize(t)},t.autoUnItalicize=function(t){var e,i,s,r,a,o,l,c,u,h,f,p,d=t.autoOperatorNames;if(0!==d._maxLength){for(e=this.letter,i=this[x];i instanceof at;i=i[x])e=i.letter+e;for(s=this[k];s instanceof at;s=s[k])e+=s.letter;C(i[k]||this.parent.ends[x],s[x]||this.parent.ends[k]).each(function(t){t.italicize(!0).jQ.removeClass("mq-first mq-last mq-followed-by-supsub"),t.ctrlSeq=t.letter});t:for(r=0,a=i[k]||this.parent.ends[x];r<e.length;r+=1,a=a[k])for(o=Ht(d._maxLength,e.length-r);o>0;o-=1)if(l=e.slice(r,r+o),d.hasOwnProperty(l)){for(c=0,u=a;c<o;c+=1,u=u[k])u.italicize(!1),h=u;f=ot.hasOwnProperty(l),a.ctrlSeq=(f?"\\":"\\operatorname{")+a.ctrlSeq,h.ctrlSeq+=f?" ":"}",ct.hasOwnProperty(l)&&h[x][x][x].jQ.addClass("mq-last"),n(a[x])||a.jQ.addClass("mq-first"),n(h[k])||(h[k]instanceof Ct?(p=h[k],(p.siblingCreated=p.siblingDeleted=function(){p.jQ.toggleClass("mq-after-operator-name",!(p[k]instanceof Bt))})()):h.jQ.toggleClass("mq-last",!(h[k]instanceof Bt))),r+=o-1,a=h;continue t}}}}),ot={},lt=B.p.autoOperatorNames={_maxLength:9},ct={limsup:1,liminf:1,projlim:1,injlim:1},function(){var t,e,n,i,s="arg deg det dim exp gcd hom inf ker lg lim ln log max min sup limsup liminf injlim projlim Pr".split(" ");for(t=0;t<s.length;t+=1)ot[s[t]]=lt[s[t]]=1;for(e="sin cos tan arcsin arccos arctan sinh cosh tanh sec csc cot coth".split(" "),t=0;t<e.length;t+=1)ot[e[t]]=1;for(n="sin cos tan sec cosec csc cotan cot ctg".split(" "),t=0;t<n.length;t+=1)lt[n[t]]=lt["arc"+n[t]]=lt[n[t]+"h"]=lt["ar"+n[t]+"h"]=lt["arc"+n[t]+"h"]=1;for(i="gcf hcf lcm proj span".split(" "),t=0;t<i.length;t+=1)lt[i[t]]=1}(),R.autoOperatorNames=function(t){var e,n,i,s,r,a;if("string"!=typeof t)throw'"'+t+'" not a space-delimited list';if(!/^[a-z\|\-]+(?: [a-z\|\-]+)*$/i.test(t))throw'"'+t+'" not a space-delimited list of letters or "|"';for(e=t.split(" "),n={},i=0,s=0;s<e.length;s+=1){if(r=e[s],r.length<2)throw'"'+r+'" not minimum length of 2';if(r.indexOf("|")<0)n[r]=r,i=Gt(i,r.length);else{if(a=r.split("|"),a.length>2)throw'"'+r+'" has more than 1 mathspeak delimiter';if(a[0].length<2)throw'"'+r[0]+'" not minimum length of 2';n[a[0]]=a[1].replace(/-/g," "),i=Gt(i,a[0].length)}}return n._maxLength=i,n},ut=q(K,function(t,e){t.init=function(t){this.ctrlSeq=t},t.createLeftOf=function(t){var e,n=this.ctrlSeq;for(e=0;e<n.length;e+=1)at(n.charAt(e)).createLeftOf(t)},t.parser=function(){var t,e=this.ctrlSeq,n=Z();for(t=0;t<e.length;t+=1)at(e.charAt(t)).adopt(n,n.ends[k],0);return P.succeed(n.children())}});for(ht in lt)lt.hasOwnProperty(ht)&&(L[ht]=ut);L.operatorname=q(G,function(e){e.createLeftOf=t,e.numBlocks=function(){return 1},e.parser=function(){return W.block.map(function(t){var e=!0,n="",i=t.children();return i.each(function(t){t instanceof at?n+=t.letter:e=!1}),e&&"ans"===n?L[n](n):i})}}),L.f=q(at,function(t,e){t.init=function(){K.p.init.call(this,this.letter="f",'<var class="mq-f">f</var>')},t.italicize=function(t){return this.jQ.html("f").toggleClass("mq-f",t),e.italicize.apply(this,arguments)}}),L[" "]=L.space=i(Y,"\\ ","&nbsp;","space"),L["'"]=L.prime=i(Y,"'","&prime;","prime"),L["″"]=L.dprime=i(Y,"″","&Prime;","double prime"),L.backslash=i(Y,"\\backslash ","\\","backslash"),S["\\"]||(S["\\"]=L.backslash),L.$=i(Y,"\\$","$","dollar"),ft=q(K,function(t,e){t.init=function(t,n){e.init.call(this,t,'<span class="mq-nonSymbola">'+(n||t)+"</span>")}}),L["@"]=ft,L["&"]=i(ft,"\\&","&amp;","and"),L["%"]=i(ft,"\\%","%","percent"),pt=q(K,function(t,e){t.init=function(t,n){e.init.call(this,t,'<span class="mq-stix">'+(n||t)+"</span>")}}),L["∥"]=L.parallel=i(pt,"\\parallel ","&#x2225;","parallel"),L["∦"]=i(pt,"\\nparallel ","&#x2226;","not parallel"),L.alpha=L.beta=L.gamma=L.delta=L.zeta=L.eta=L.theta=L.iota=L.kappa=L.mu=L.nu=L.xi=L.rho=L.sigma=L.tau=L.chi=L.psi=L.omega=q(rt,function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}}),L.phi=i(rt,"\\phi ","&#981;","phi"),L.phiv=L.varphi=i(rt,"\\varphi ","&phi;","phi"),L.epsilon=i(rt,"\\epsilon ","&#1013;","epsilon"),L.epsiv=L.varepsilon=i(rt,"\\varepsilon ","&epsilon;","epsilon"),L.piv=L.varpi=i(rt,"\\varpi ","&piv;","piv"),L.sigmaf=L.sigmav=L.varsigma=i(rt,"\\varsigma ","&sigmaf;","sigma"),L.thetav=L.vartheta=L.thetasym=i(rt,"\\vartheta ","&thetasym;","theta"),L.upsilon=L.upsi=i(rt,"\\upsilon ","&upsilon;","upsilon"),L.gammad=L.Gammad=L.digamma=i(rt,"\\digamma ","&#989;","gamma"),L.kappav=L.varkappa=i(rt,"\\varkappa ","&#1008;","kappa"),L.rhov=L.varrho=i(rt,"\\varrho ","&#1009;","rho"),L.pi=L["π"]=i(ft,"\\pi ","&pi;","pi"),L.lambda=i(ft,"\\lambda ","&lambda;","lambda"),L.Upsilon=L.Upsi=L.upsih=L.Upsih=i(K,"\\Upsilon ",'<var style="font-family: serif">&upsih;</var>',"capital upsilon"),L.Gamma=L.Delta=L.Theta=L.Lambda=L.Xi=L.Pi=L.Sigma=L.Phi=L.Psi=L.Omega=L.forall=q(Y,function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}}),dt=q(G,function(t){t.init=function(t){this.latex=t},t.createLeftOf=function(t){var e=W.parse(this.latex);e.children().adopt(t.parent,t[x],t[k]),t[x]=e.ends[k],e.jQize().insertBefore(t.jQ),e.finalizeInsert(t.options,t),e.ends[k][k].siblingCreated&&e.ends[k][k].siblingCreated(t.options,x),e.ends[x][x].siblingCreated&&e.ends[x][x].siblingCreated(t.options,k),
t.parent.bubble("reflow")},t.mathspeak=function(){return W.parse(this.latex).mathspeak()},t.parser=function(){var t=W.parse(this.latex).children();return P.succeed(t)}}),L["¹"]=i(dt,"^1"),L["²"]=i(dt,"^2"),L["³"]=i(dt,"^3"),L["¼"]=i(dt,"\\frac14"),L["½"]=i(dt,"\\frac12"),L["¾"]=i(dt,"\\frac34"),mt=q(X,function(t){t.init=Y.prototype.init,t.contactWeld=t.siblingCreated=t.siblingDeleted=function(t,e){function n(t){return t[x]?t[x]instanceof X||/^[,;:\(\[]$/.test(t[x].ctrlSeq)?"":"mq-binary-operator":t.parent&&t.parent.parent&&t.parent.parent.isStyleBlock()?n(t.parent.parent):""}if(e!==k)return this.jQ[0].className=n(this),this}}),L["+"]=i(mt,"+","+","plus"),L["–"]=L["-"]=i(mt,"-","&minus;","minus"),L["±"]=L.pm=L.plusmn=L.plusminus=i(mt,"\\pm ","&plusmn;","plus-or-minus"),L.mp=L.mnplus=L.minusplus=i(mt,"\\mp ","&#8723;","minus-or-plus"),S["*"]=L.sdot=L.cdot=i(X,"\\cdot ","&middot;","*","times"),gt=q(X,function(t,e){t.init=function(t,n){this.data=t,this.strict=n;var i=n?"Strict":"";e.init.call(this,t["ctrlSeq"+i],t["html"+i],t["text"+i])},t.swap=function(t){this.strict=t;var e=t?"Strict":"";this.ctrlSeq=this.data["ctrlSeq"+e],this.jQ.html(this.data["html"+e]),this.textTemplate=[this.data["text"+e]]},t.deleteTowards=function(t,n){if(t===x&&!this.strict)return this.swap(!0),void this.bubble("reflow");e.deleteTowards.apply(this,arguments)}}),bt={ctrlSeq:"\\le ",html:"&le;",text:"≤",ctrlSeqStrict:"<",htmlStrict:"&lt;",textStrict:"<"},vt={ctrlSeq:"\\ge ",html:"&ge;",text:"≥",ctrlSeqStrict:">",htmlStrict:"&gt;",textStrict:">"},L["<"]=L.lt=i(gt,bt,!0),L[">"]=L.gt=i(gt,vt,!0),L["≤"]=L.le=L.leq=i(gt,bt,!1),L["≥"]=L.ge=L.geq=i(gt,vt,!1),wt=q(X,function(t,e){t.init=function(){e.init.call(this,"=","=","=","equals")},t.createLeftOf=function(t){if(t[x]instanceof gt&&t[x].strict)return t[x].swap(!1),void t[x].bubble("reflow");e.createLeftOf.apply(this,arguments)}}),L["="]=wt,L["×"]=L.times=i(X,"\\times ","&times;","[x]","times"),L["÷"]=L.div=L.divide=L.divides=i(X,"\\div ","&divide;","[/]","over"),S["~"]=L.sim=i(X,"\\sim ","~","~","tilde"),xt=t,kt=document.createElement("div"),yt=kt.style,Ot={transform:1,WebkitTransform:1,MozTransform:1,OTransform:1,msTransform:1};for(Qt in Ot)if(Qt in yt){jt=Qt;break}jt?qt=function(t,e,n){t.css(jt,"scale("+e+","+n+")")}:"filter"in yt?(xt=function(t){t.className=t.className},qt=function(t,e,n){function i(){t.css("marginRight",(s.width()-1)*(e-1)/e+"px")}var s,r;e/=1+(n-1)/2,t.css("fontSize",n+"em"),t.hasClass("mq-matrixed-container")||t.addClass("mq-matrixed-container").wrapInner('<span class="mq-matrixed"></span>'),s=t.children().css("filter","progid:DXImageTransform.Microsoft.Matrix(M11="+e+",SizingMethod='auto expand')"),i(),r=setInterval(i),y(window).load(function(){clearTimeout(r),i()})}):qt=function(t,e,n){t.css("fontSize",n+"em")},Tt=q(G,function(t,e){t.init=function(t,n,i){e.init.call(this,t,"<"+n+" "+i+">&0</"+n+">")}}),L.mathrm=i(Tt,"\\mathrm","span",'class="mq-roman mq-font"'),L.mathit=i(Tt,"\\mathit","i",'class="mq-font"'),L.mathbf=i(Tt,"\\mathbf","b",'class="mq-font"'),L.mathsf=i(Tt,"\\mathsf","span",'class="mq-sans-serif mq-font"'),L.mathtt=i(Tt,"\\mathtt","span",'class="mq-monospace mq-font"'),L.underline=i(Tt,"\\underline","span",'class="mq-non-leaf mq-underline"'),L.overline=L.bar=i(Tt,"\\overline","span",'class="mq-non-leaf mq-overline"'),L.overrightarrow=i(Tt,"\\overrightarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-right"'),L.overleftarrow=i(Tt,"\\overleftarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-left"'),L.textcolor=q(G,function(t,e){t.setColor=function(t){this.color=t,this.htmlTemplate='<span class="mq-textcolor" style="color:'+t+'">&0</span>'},t.latex=function(){return"\\textcolor{"+this.color+"}{"+this.blocks[0].latex()+"}"},t.parser=function(){var t=this,n=P.optWhitespace,i=P.string,s=P.regex;return n.then(i("{")).then(s(/^[#\w\s.,()%-]*/)).skip(i("}")).then(function(n){return t.setColor(n),e.parser.call(t)})},t.isStyleBlock=function(){return!0}}),L.class=q(G,function(t,e){t.parser=function(){var t=this,n=P.string,i=P.regex;return P.optWhitespace.then(n("{")).then(i(/^[-\w\s\\\xA0-\xFF]*/)).skip(n("}")).then(function(n){return t.cls=n||"",t.htmlTemplate='<span class="mq-class '+n+'">&0</span>',e.parser.call(t)})},t.latex=function(){return"\\class{"+this.cls+"}{"+this.blocks[0].latex()+"}"},t.isStyleBlock=function(){return!0}}),Ct=q(G,function(t,e){t.ctrlSeq="_{...}^{...}",t.createLeftOf=function(t){if(this.replacedFragment||t[x]||!t.options.supSubsRequireOperand)return e.createLeftOf.apply(this,arguments)},t.contactWeld=function(t){var e,n,i,s,r,a;for(e=x;e;e=e===x&&k)if(this[e]instanceof Ct){for(n="sub";n;n="sub"===n&&"sup")i=this[n],s=this[e][n],i&&(s?i.isEmpty()?a=O(s,0,s.ends[x]):(i.jQ.children().insAtDirEnd(-e,s.jQ),r=i.children().disown(),a=O(s,r.ends[k],s.ends[x]),e===x?r.adopt(s,s.ends[k],0):r.adopt(s,0,s.ends[x])):this[e].addBlock(i.disown()),this.placeCursor=function(t,n){return function(i){i.insAtDirEnd(-e,t||n)}}(s,i));this.remove(),t&&t[x]===this&&(e===k&&a?a[x]?t.insRightOf(a[x]):t.insAtLeftEnd(a.parent):t.insRightOf(this[e]));break}},B.p.charsThatBreakOutOfSupSub="",t.finalizeTree=function(){this.ends[x].write=function(t,e){if(t.options.autoSubscriptNumerals&&this===this.parent.sub){if("_"===e)return;var n=this.chToCmd(e,t.options);return n instanceof K?t.deleteSelection():t.clearSelection().insRightOf(this.parent),n.createLeftOf(t.show()),void U.queue("Baseline").alert(n.mathspeak({createdLeftOf:t}))}t[x]&&!t[k]&&!t.selection&&t.options.charsThatBreakOutOfSupSub.indexOf(e)>-1&&(t.insRightOf(this.parent),U.queue("Baseline")),Z.p.write.apply(this,arguments)}},t.moveTowards=function(t,n,i){n.options.autoSubscriptNumerals&&!this.sup?n.insDirOf(t,this):e.moveTowards.apply(this,arguments)},t.deleteTowards=function(t,n){if(n.options.autoSubscriptNumerals&&this.sub){var i=this.sub.ends[-t];i instanceof K?i.remove():i&&i.deleteTowards(t,n.insAtDirEnd(-t,this.sub)),this.sub.isEmpty()&&(this.sub.deleteOutOf(x,n.insAtLeftEnd(this.sub)),this.sup&&n.insDirOf(-t,this))}else e.deleteTowards.apply(this,arguments)},t.latex=function(){function t(t,e){var n=e&&e.latex();return e?t+(1===n.length?n:"{"+(n||" ")+"}"):""}return t("_",this.sub)+t("^",this.sup)},t.addBlock=function(t){"sub"===this.supsub?(this.sup=this.upInto=this.sub.upOutOf=t,t.adopt(this,this.sub,0).downOutOf=this.sub,t.jQ=y('<span class="mq-sup"/>').append(t.jQ.children()).prependTo(this.jQ),T.linkElementByBlockNode(t.jQ[0],t)):(this.sub=this.downInto=this.sup.downOutOf=t,t.adopt(this,0,this.sup).upOutOf=this.sup,t.jQ=y('<span class="mq-sub"></span>').append(t.jQ.children()).appendTo(this.jQ.removeClass("mq-sup-only")),T.linkElementByBlockNode(t.jQ[0],t),this.jQ.append('<span style="display:inline-block;width:0">&#8203;</span>'));for(var e=0;e<2;e+=1)!function(t,e,n,i){t[e].deleteOutOf=function(s,r){if(r.insDirOf(this[s]?-s:s,this.parent),!this.isEmpty()){var a=this.ends[s];this.children().disown().withDirAdopt(s,r.parent,r[s],r[-s]).jQ.insDirOf(-s,r.jQ),r[-s]=a}t.supsub=n,delete t[e],delete t[i+"Into"],t[n][i+"OutOf"]=d,delete t[n].deleteOutOf,"sub"===e&&y(t.jQ.addClass("mq-sup-only")[0].lastChild).remove(),this.remove()}}(this,"sub sup".split(" ")[e],"sup sub".split(" ")[e],"down up".split(" ")[e])}}),L.subscript=L._=q(Ct,function(t,e){t.supsub="sub",t.htmlTemplate='<span class="mq-supsub mq-non-leaf"><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8203;</span></span>',t.textTemplate=["_"],t.mathspeakTemplate=["Subscript,",", Baseline"],t.ariaLabel="subscript",t.finalizeTree=function(){this.downInto=this.sub=this.ends[x],this.sub.upOutOf=d,e.finalizeTree.call(this)}}),L.superscript=L.supscript=L["^"]=q(Ct,function(t,e){t.supsub="sup",t.htmlTemplate='<span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup">&0</span></span>',t.textTemplate=["^"],t.mathspeakTemplate=["Superscript,",", Baseline"],t.ariaLabel="superscript",t.finalizeTree=function(){this.upInto=this.sup=this.ends[k],this.sup.downOutOf=d,e.finalizeTree.call(this)}}),Lt=q(G,function(t,e){t.init=function(e,n,i){t.ariaLabel=i||ctrlSeq;var s='<span class="mq-large-operator mq-non-leaf"><span class="mq-to"><span>&1</span></span><big>'+n+'</big><span class="mq-from"><span>&0</span></span></span>';K.prototype.init.call(this,e,s)},t.createLeftOf=function(t){e.createLeftOf.apply(this,arguments),t.options.sumStartsWithNEquals&&(at("n").createLeftOf(t),wt().createLeftOf(t))},t.latex=function(){function t(t){return 1===t.length?t:"{"+(t||" ")+"}"}return this.ctrlSeq+"_"+t(this.ends[x].latex())+"^"+t(this.ends[k].latex())},t.mathspeak=function(){return"Start "+this.ariaLabel+" from "+this.ends[x].mathspeak()+" to "+this.ends[k].mathspeak()+", end "+this.ariaLabel+", "},t.parser=function(){var t,e=P.string,n=P.optWhitespace,i=P.succeed,s=W.block,r=this,a=r.blocks=[Z(),Z()];for(t=0;t<a.length;t+=1){switch(t){case 0:a[t].ariaLabel="lower bound";break;case 1:a[t].ariaLabel="upper bound";break;default:a[t].ariaLabel="block "+t}a[t].adopt(r,r.ends[k],0)}return n.then(e("_").or(e("^"))).then(function(t){var e=a["_"===t?0:1];return s.then(function(t){return t.children().adopt(e,e.ends[k],0),i(r)})}).many().result(r)},t.finalizeTree=function(){this.downInto=this.ends[x],this.upInto=this.ends[k],this.ends[x].upOutOf=this.ends[k],this.ends[k].downOutOf=this.ends[x]}}),L["∏"]=L.sum=L.summation=i(Lt,"\\sum ","&sum;","sum"),L["∑"]=L.prod=L.product=i(Lt,"\\prod ","&prod;","product"),L.coprod=L.coproduct=i(Lt,"\\coprod ","&#8720;","co product"),L["∫"]=L.int=L.integral=q(Lt,function(t,e){t.init=function(){t.ariaLabel="integral";K.prototype.init.call(this,"\\int ",'<span class="mq-int mq-non-leaf"><big>&int;</big><span class="mq-supsub mq-non-leaf"><span class="mq-sup"><span class="mq-sup-inner">&1</span></span><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8203</span></span></span>',"integral")},t.createLeftOf=G.p.createLeftOf}),St=L.frac=L.dfrac=L.cfrac=L.fraction=q(G,function(t,e){t.ctrlSeq="\\frac",t.htmlTemplate='<span class="mq-fraction mq-non-leaf"><span class="mq-numerator">&0</span><span class="mq-denominator">&1</span><span style="display:inline-block;width:0">&#8203;</span></span>',t.textTemplate=["(",")/(",")"],t.finalizeTree=function(){this.upInto=this.ends[k].upOutOf=this.ends[x],this.downInto=this.ends[x].downOutOf=this.ends[k],this.ends[x].ariaLabel="numerator",this.ends[k].ariaLabel="denominator",this.getFracDepth()>1?this.mathspeakTemplate=["StartNestedFraction,","NestedOver",", EndNestedFraction"]:this.mathspeakTemplate=["StartFraction,","Over",", EndFraction"]},t.mathspeak=function(t){if(t&&t.createdLeftOf){return t.createdLeftOf.parent.mathspeak()}return e.mathspeak.apply(this,arguments)},t.getFracDepth=function(){var t=function(e,n){return e instanceof T&&e.ctrlSeq&&e.ctrlSeq.toLowerCase().search("frac")>=0&&(n+=1),e.parent?t(e.parent,n):n};return t(this,0)}}),_t=L.over=S["/"]=q(St,function(e,n){e.createLeftOf=function(e){if(!this.replacedFragment){for(var i=e[x];i&&!(i instanceof X||i instanceof(L.text||t)||i instanceof Lt||"\\ "===i.ctrlSeq||/^[,;:]$/.test(i.ctrlSeq));)i=i[x];i instanceof Lt&&i[k]instanceof Ct&&(i=i[k],i[k]instanceof Ct&&i[k].ctrlSeq!=i.ctrlSeq&&(i=i[k])),i!==e[x]&&(this.replaces(C(i[k]||e.parent.ends[x],e[x])),e[x]=i)}n.createLeftOf.call(this,e)}}),L.ans=q(K,function(t,e){t.init=function(t){e.init.call(this,"\\operatorname{ans}",'<span class="mq-ans">ans</span>',"ans")}}),Dt=L.sqrt=L["√"]=q(G,function(t,e){t.ctrlSeq="\\sqrt",t.htmlTemplate='<span class="mq-non-leaf"><span class="mq-scaled mq-sqrt-prefix">&radic;</span><span class="mq-non-leaf mq-sqrt-stem">&0</span></span>',t.textTemplate=["sqrt(",")"],t.mathspeakTemplate=["StartRoot,",", EndRoot"],t.ariaLabel="root",t.parser=function(){return W.optBlock.then(function(t){return W.block.map(function(e){var n=Et();return n.blocks=[t,e],t.adopt(n,0,0),e.adopt(n,t,0),n})}).or(e.parser.call(this))},t.reflow=function(){var t=this.ends[k].jQ;qt(t.prev(),1,t.innerHeight()/+t.css("fontSize").slice(0,-2)-.1)}}),L.hat=q(G,function(t,e){t.ctrlSeq="\\hat",t.htmlTemplate='<span class="mq-non-leaf"><span class="mq-hat-prefix">^</span><span class="mq-hat-stem">&0</span></span>',t.textTemplate=["hat(",")"]}),Et=L.nthroot=q(Dt,function(t,e){t.htmlTemplate='<sup class="mq-nthroot mq-non-leaf">&0</sup><span class="mq-scaled"><span class="mq-sqrt-prefix mq-scaled">&radic;</span><span class="mq-sqrt-stem mq-non-leaf">&1</span></span>',t.textTemplate=["sqrt[","](",")"],t.latex=function(){return"\\sqrt["+this.ends[x].latex()+"]{"+this.ends[k].latex()+"}"}}),At=q(G,function(t,e){t.init=function(t,n,i){var s='<span class="mq-non-leaf"><span class="mq-diacritic-above">'+n+'</span><span class="mq-diacritic-stem">&0</span></span>';e.init.call(this,t,s,i)}}),L.vec=i(At,"\\vec","&rarr;",["vec(",")"]),L.tilde=i(At,"\\tilde","~",["tilde(",")"]),Bt=q(q(G,m),function(e,n){e.init=function(t,e,i,s,r){n.init.call(this,"\\left"+s,b,[e,i]),this.side=t,this.sides={},this.sides[x]={ch:e,ctrlSeq:s},this.sides[k]={ch:i,ctrlSeq:r}},e.numBlocks=function(){return 1},e.html=function(){return this.htmlTemplate='<span class="mq-non-leaf"><span class="mq-scaled mq-paren'+(this.side===k?" mq-ghost":"")+'">'+this.sides[x].ch+'</span><span class="mq-non-leaf">&0</span><span class="mq-scaled mq-paren'+(this.side===x?" mq-ghost":"")+'">'+this.sides[k].ch+"</span></span>",n.html.call(this)},e.latex=function(){return"\\left"+this.sides[x].ctrlSeq+this.ends[x].latex()+"\\right"+this.sides[k].ctrlSeq},e.mathspeak=function(t){var e,i=this.sides[x].ch,s=this.sides[k].ch;if("|"===i&&"|"===s)this.mathspeakTemplate=["StartAbsoluteValue,",", EndAbsoluteValue"],this.ariaLabel="absolute value";else{if(t&&t.createdLeftOf&&this.side)return e="",this.side===x?e=this.textTemplate[0]:this.side===k&&(e=this.textTemplate[1]),(this.side===x?"left ":"right ")+It[e];this.mathspeakTemplate=["left "+It[i]+",",", right "+It[s]],this.ariaLabel=It[i]+" block"}return n.mathspeak.call(this)},e.matchBrack=function(t,e,n){return n instanceof Bt&&n.side&&n.side!==-e&&(!t.restrictMismatchedBrackets||Rt[this.sides[this.side].ch]===n.sides[n.side].ch||{"(":"]","[":")"}[this.sides[x].ch]===n.sides[k].ch)&&n},e.closeOpposing=function(t){t.side=0,t.sides[this.side]=this.sides[this.side],t.delimjQs.eq(this.side===x?0:1).removeClass("mq-ghost").html(this.sides[this.side].ch)},e.createLeftOf=function(t){var e,i,s;this.replacedFragment||(e=t.options,i="|"===this.sides[x].ch?this.matchBrack(e,k,t[k])||this.matchBrack(e,x,t[x])||this.matchBrack(e,0,t.parent.parent):this.matchBrack(e,-this.side,t[-this.side])||this.matchBrack(e,-this.side,t.parent.parent)),i?(s=this.side=-i.side,this.closeOpposing(i),i===t.parent.parent&&t[s]&&C(t[s],t.parent.ends[s],-s).disown().withDirAdopt(-s,i.parent,i,i[s]).jQ.insDirOf(s,i.jQ),i.bubble("reflow")):(i=this,s=i.side,i.replacedFragment?i.side=0:t[-s]&&(i.replaces(C(t[-s],t.parent.ends[-s],s)),t[-s]=0),n.createLeftOf.call(i,t)),s===x?t.insAtLeftEnd(i.ends[x]):t.insRightOf(i)},e.placeCursor=t,e.unwrap=function(){this.ends[x].children().disown().adopt(this.parent,this,this[k]).jQ.insertAfter(this.jQ),this.remove()},e.deleteSide=function(t,e,n){var i,s,r,a=this.parent,o=this[t],l=a.ends[t];if(t===this.side)return this.unwrap(),void(o?n.insDirOf(-t,o):n.insAtDirEnd(t,a));if(i=n.options,s=!this.side,this.side=-t,this.matchBrack(i,t,this.ends[x].ends[this.side]))this.closeOpposing(this.ends[x].ends[this.side]),r=this.ends[x].ends[t],this.unwrap(),r.siblingCreated&&r.siblingCreated(n.options,t),o?n.insDirOf(-t,o):n.insAtDirEnd(t,a);else{if(this.matchBrack(i,t,this.parent.parent))this.parent.parent.closeOpposing(this),this.parent.parent.unwrap();else{if(e&&s)return this.unwrap(),void(o?n.insDirOf(-t,o):n.insAtDirEnd(t,a));this.sides[t]={ch:Rt[this.sides[this.side].ch],ctrlSeq:Rt[this.sides[this.side].ctrlSeq]},this.delimjQs.removeClass("mq-ghost").eq(t===x?0:1).addClass("mq-ghost").html(this.sides[t].ch)}o?(r=this.ends[x].ends[t],C(o,l,-t).disown().withDirAdopt(-t,this.ends[x],r,0).jQ.insAtDirEnd(t,this.ends[x].jQ.removeClass("mq-empty")),r.siblingCreated&&r.siblingCreated(n.options,t),n.insDirOf(-t,o)):e?n.insDirOf(t,this):n.insAtDirEnd(t,this.ends[x])}},e.deleteTowards=function(t,e){this.deleteSide(-t,!1,e)},e.finalizeTree=function(){this.ends[x].deleteOutOf=function(t,e){this.parent.deleteSide(t,!0,e)},this.finalizeTree=this.intentionalBlur=function(){this.delimjQs.eq(this.side===x?1:0).removeClass("mq-ghost"),this.side=0}},e.siblingCreated=function(t,e){e===-this.side&&this.finalizeTree()}}),Rt={"(":")",")":"(","[":"]","]":"[","{":"}","}":"{","\\{":"\\}","\\}":"\\{","&lang;":"&rang;","&rang;":"&lang;","\\langle ":"\\rangle ","\\rangle ":"\\langle ","|":"|","\\lVert ":"\\rVert ","\\rVert ":"\\lVert "},It={"&lang;":"angle-bracket","&rang;":"angle-bracket","|":"pipe"},g("(",null,"parenthesis"),g("[",null,"bracket"),g("{","\\{","brace"),L.langle=i(Bt,x,"&lang;","&rang;","\\langle ","\\rangle "),L.rangle=i(Bt,k,"&lang;","&rang;","\\langle ","\\rangle "),S["|"]=i(Bt,x,"|","|","|","|"),L.lVert=i(Bt,x,"&#8741;","&#8741;","\\lVert ","\\rVert "),L.rVert=i(Bt,k,"&#8741;","&#8741;","\\lVert ","\\rVert "),L.left=q(G,function(t){t.parser=function(){var t=P.regex,e=P.string,n=(P.succeed,P.optWhitespace);return n.then(t(/^(?:[([|]|\\\{|\\langle\b|\\lVert\b)/)).then(function(i){var s="\\"===i.charAt(0)?i.slice(1):i;return"\\langle"==i&&(s="&lang;",i+=" "),"\\lVert"==i&&(s="&#8741;",i+=" "),W.then(function(r){return e("\\right").skip(n).then(t(/^(?:[\])|]|\\\}|\\rangle\b|\\rVert\b)/)).map(function(t){var e,n="\\"===t.charAt(0)?t.slice(1):t;return"\\rangle"==t&&(n="&rang;",t+=" "),"\\rVert"==t&&(n="&#8741;",t+=" "),e=Bt(0,s,n,i,t),e.blocks=[r],r.adopt(e,0,0),e})})})}}),L.right=q(G,function(t){t.parser=function(){return P.fail("unmatched \\right")}}),zt=L.binom=L.binomial=q(q(G,m),function(t,e){t.ctrlSeq="\\binom",t.htmlTemplate='<span class="mq-non-leaf"><span class="mq-paren mq-scaled">(</span><span class="mq-non-leaf"><span class="mq-array mq-non-leaf"><span>&0</span><span>&1</span></span></span><span class="mq-paren mq-scaled">)</span></span>',t.textTemplate=["choose(",",",")"],t.mathspeakTemplate=["StartBinomial,","Choose",", EndBinomial"],t.ariaLabel="binomial"}),L.choose=q(zt,function(t){t.createLeftOf=_t.prototype.createLeftOf}),L.editable=L.MathQuillMathField=q(G,function(t,e){t.ctrlSeq="\\MathQuillMathField",t.htmlTemplate='<span class="mq-editable-field"><span class="mq-root-block">&0</span></span>',t.parser=function(){var t=this,n=P.string,i=P.regex,s=P.succeed;return n("[").then(i(/^[a-z][a-z0-9]*/i)).skip(n("]")).map(function(e){t.name=e}).or(s()).then(e.parser.call(t))},t.finalizeTree=function(t){var e=E(this.ends[x],this.jQ,t);e.KIND_OF_MQ="MathField",e.editable=!0,e.createTextarea(),e.editablesTextareaEvents(),e.cursor.insAtRightEnd(e.root),f(e.root)},t.registerInnerField=function(t,e){t.push(t[this.name]=e(this.ends[x].controller))},t.latex=function(){return this.ends[x].latex()},t.text=function(){return this.ends[x].text()}}),Mt=L.embed=q(K,function(t,e){t.setOptions=function(t){function e(){return""}return this.text=t.text||e,this.htmlTemplate=t.htmlString||"",this.latex=t.latex||e,this},t.parser=function(){var t=this,e=P.string,n=P.regex,i=P.succeed;return e("{").then(n(/^[a-z][a-z0-9]*/i)).skip(e("}")).then(function(s){return e("[").then(n(/^[-\w\s]*/)).skip(e("]")).or(i()).map(function(e){return t.setOptions(z[s](e))})})}}),Nt={},L.begin=q(G,function(t,e){t.parser=function(){var t=P.string,e=P.regex;return t("{").then(e(/^[a-z]+/i)).skip(t("}")).then(function(e){return(Nt[e]?Nt[e]().parser():P.fail("unknown environment type: "+e)).skip(t("\\end{"+e+"}"))})}}),Ft=q(G,function(t,e){t.template=[["\\begin{","}"],["\\end{","}"]],t.wrappers=function(){return[t.template[0].join(this.environment),t.template[1].join(this.environment)]}}),Pt=Nt.matrix=q(Ft,function(t,e){var n={column:"&",row:"\\\\"};t.parentheses={left:null,right:null},t.environment="matrix",t.reflow=function(){var t=this.jQ.children("table"),e=t.outerHeight()/+t.css("fontSize").slice(0,-2),n=this.jQ.children(".mq-paren");n.length&&qt(n,Ht(1+.2*(e-1),1.2),1.05*e)},t.latex=function(){var t,e="";return this.eachChild(function(i){void 0!==t&&(e+=t!==i.row?n.row:n.column),t=i.row,e+=i.latex()}),this.wrappers().join(e)},t.html=function(){function t(t){return t?'<span class="mq-scaled mq-paren">'+t+"</span>":""}var n,i=[],s="",r=0;return this.eachChild(function(t){n!==t.row&&(n=t.row,s+="<tr>$tds</tr>",i[n]=[]),i[n].push("<td>&"+r+++"</td>")}),this.htmlTemplate='<span class="mq-matrix mq-non-leaf">'+t(this.parentheses.left)+'<table class="mq-non-leaf">'+s.replace(/\$tds/g,function(){return i.shift().join("")})+"</table>"+t(this.parentheses.right)+"</span>",e.html.call(this)},t.createBlocks=function(){this.blocks=[$t(0,this),$t(0,this),$t(1,this),$t(1,this)]},t.parser=function(){var t=this,e=P.optWhitespace,i=P.string;return e.then(i(n.column).or(i(n.row)).or(W.block)).many().skip(e).then(function(e){function i(){t.blocks.push($t(a,t,r)),r=[]}var s,r=[],a=0;for(t.blocks=[],s=0;s<e.length;s+=1)e[s]instanceof Z?r.push(e[s]):(i(),e[s]===n.row&&(a+=1));return i(),t.autocorrect(),P.succeed(t)})},t.finalizeTree=function(){var t=this.jQ.find("table");t.toggleClass("mq-rows-1",1===t.find("tr").length),this.relink()},t.relink=function(){var t,e,n,i,s=this.blocks,r=[];for(i=0;i<s.length;i+=1)n=s[i],t!==n.row&&(t=n.row,r[t]=[],e=0),r[t][e]=n,n[k]=s[i+1],n[x]=s[i-1],r[t-1]&&r[t-1][e]&&(n.upOutOf=r[t-1][e],r[t-1][e].downOutOf=n),e+=1;this.ends[x]=s[0],this.ends[k]=s[s.length-1]},t.autocorrect=function(t){var e,n,i,s,r,a,o=[];for(t=[],e=this.blocks,a=0;a<e.length;a+=1)r=e[a].row,t[r]=t[r]||[],t[r].push(e[a]),o[r]=t[r].length;if((n=Math.max.apply(null,o))!==Math.min.apply(null,o)){for(a=0;a<t.length;a+=1)for(i=n-t[a].length;i;)s=n*a+t[a].length,e.splice(s,0,$t(a,this)),i-=1;this.relink()}},t.deleteCell=function(t){function e(t){var e,n=[];for(e=0;e<t.length;e+=1)t[e].isEmpty()&&n.push(t[e]);return n.length===t.length}function n(t){for(var e=0;e<t.length;e+=1)c.indexOf(t[e])>-1&&(t[e].remove(),c.splice(c.indexOf(t[e]),1))}var i,s,r=[],a=[],o=[],l=[],c=this.blocks;this.eachChild(function(e){i!==e.row&&(i=e.row,r[i]=[],s=0),a[s]=a[s]||[],a[s].push(e),r[i].push(e),e===t&&(o=r[i],l=a[s]),s+=1}),e(o)&&l.length>1&&(i=r.indexOf(o),this.eachChild(function(t){t.row>i&&(t.row-=1)}),n(o),this.jQ.find("tr").eq(i).remove()),e(l)&&o.length>1&&n(l),this.finalizeTree()},t.addRow=function(t){var e,n,i,s=[],r=[],a=[],o=y("<tr></tr>"),l=t.row,c=0;for(this.eachChild(function(e){e.row<=l&&s.push(e),e.row===l&&(e===t&&(n=c),c+=1),e.row>l&&(e.row+=1,a.push(e))}),i=0;i<c;i+=1)e=$t(l+1),e.parent=this,r.push(e),e.jQ=y('<td class="mq-empty">').attr(mqBlockId,e.id).appendTo(o);return this.jQ.find("tr").eq(l).after(o),this.blocks=s.concat(r,a),r[n]},t.addColumn=function(t){var e,n,i,s=[],r=[];for(this.eachChild(function(n){s[n.row]=s[n.row]||[],s[n.row].push(n),n===t&&(e=s[n.row].length)}),i=0;i<s.length;i+=1)n=$t(i),n.parent=this,r.push(n),s[i].splice(e,0,n),n.jQ=y('<td class="mq-empty">').attr(mqBlockId,n.id);return this.jQ.find("tr").each(function(t){y(this).find("td").eq(e-1).after(s[t][e].jQ)}),this.blocks=[].concat.apply([],s),r[t.row]},t.insert=function(t,e){var n=this[t](e);this.cursor=this.cursor||this.parent.cursor,this.finalizeTree(),this.bubble("reflow").cursor.insAtRightEnd(n)},t.backspace=function(t,e,n,i){var s=t[e];if(t.isEmpty()){for(this.deleteCell(t);s&&s[e]&&-1===this.blocks.indexOf(s);)s=s[e];s&&n.insAtDirEnd(-e,s),1===this.blocks.length&&this.blocks[0].isEmpty()&&(i(),this.finalizeTree()),this.bubble("edited")}}}),Nt.pmatrix=q(Pt,function(t,e){t.environment="pmatrix",t.parentheses={left:"(",right:")"}}),Nt.bmatrix=q(Pt,function(t,e){t.environment="bmatrix",t.parentheses={left:"[",right:"]"}}),Nt.Bmatrix=q(Pt,function(t,e){t.environment="Bmatrix",t.parentheses={left:"{",right:"}"}}),Nt.vmatrix=q(Pt,function(t,e){t.environment="vmatrix",t.parentheses={left:"|",right:"|"}}),Nt.Vmatrix=q(Pt,function(t,e){t.environment="Vmatrix",t.parentheses={left:"&#8214;",right:"&#8214;"}}),$t=q(Z,function(t,e){t.init=function(t,n,i){if(e.init.call(this),this.row=t,n&&this.adopt(n,n.ends[k],0),i)for(var s=0;s<i.length;s++)i[s].children().adopt(this,this.ends[k],0)},t.keystroke=function(t,n,i){switch(t){case"Shift-Spacebar":return n.preventDefault(),this.parent.insert("addColumn",this);case"Shift-Enter":return this.parent.insert("addRow",this)}return e.keystroke.apply(this,arguments)},t.deleteOutOf=function(t,n){var i=this,s=arguments;this.parent.backspace(this,t,n,function(){return e.deleteOutOf.apply(i,s)})}}),S["\\"]=q(G,function(t,e){t.ctrlSeq="\\",t.replaces=function(t){this._replacedFragment=t.disown(),this.isEmpty=function(){return!1}},t.htmlTemplate='<span class="mq-latex-command-input mq-non-leaf">\\<span>&0</span></span>',t.textTemplate=["\\"],t.createBlocks=function(){e.createBlocks.call(this),this.ends[x].focus=function(){return this.parent.jQ.addClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.removeClass("mq-empty"),this},this.ends[x].blur=function(){return this.parent.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.addClass("mq-empty"),this},this.ends[x].write=function(t,e){if(t.show().deleteSelection(),e.match(/[a-z]/i))Y(e).createLeftOf(t),U.alert(e);else{var n=this.parent.renderCommand(t);U.queue(n.mathspeak({createdLeftOf:t})),"\\"===e&&this.isEmpty()?U.alert():this.parent.parent.write(t,e)}},this.ends[x].keystroke=function(t,n,i){if("Tab"===t||"Enter"===t||"Spacebar"===t){var s=this.parent.renderCommand(i.cursor);return U.alert(s.mathspeak({createdLeftOf:i.cursor})),void n.preventDefault()}return e.keystroke.apply(this,arguments)}},t.createLeftOf=function(t){if(e.createLeftOf.call(this,t),this._replacedFragment){var n=this.jQ[0];this.jQ=this._replacedFragment.jQ.addClass("mq-blur").bind("mousedown mousemove",function(t){return y(t.target=n).trigger(t),!1}).insertBefore(this.jQ).add(this.jQ)}},t.latex=function(){return"\\"+this.ends[x].latex()+" "},t.renderCommand=function(t){var e,n;return this.jQ=this.jQ.last(),this.remove(),this[k]?t.insLeftOf(this[k]):t.insAtRightEnd(this.parent),e=this.ends[x].latex(),e||(e=" "),n=L[e]||Nt[e],n?(n=n(e),this._replacedFragment&&n.replaces(this._replacedFragment),n.createLeftOf(t)):(n=tt(),n.replaces(e),n.createLeftOf(t),t.insRightOf(n),this._replacedFragment&&this._replacedFragment.remove()),n}}),Vt=h(1);for(Ut in Vt)!function(t,e){"function"==typeof e?(u[t]=function(){return c(),e.apply(this,arguments)},u[t].prototype=e.prototype):u[t]=e}(Ut,Vt[Ut])}();
